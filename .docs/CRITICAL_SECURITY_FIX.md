# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò - –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê:

**`SUPABASE_ANON_KEY` –≤–∏–¥–µ–Ω –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ!**

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ:
1. –õ—é–±–æ–π –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å DevTools –∏ —É–≤–∏–¥–µ—Ç—å –∫–ª—é—á
2. –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –≤ Supabase
3. **–û–ë–•–û–î–ò–¢ –í–°–Æ –í–ê–õ–ò–î–ê–¶–ò–Æ API!**

## üîç –ì–î–ï –ü–†–û–ë–õ–ï–ú–ê:

1. **`tamagotchi-game.html`** (—Å—Ç—Ä–æ–∫–∞ 8955):
   ```javascript
   const SUPABASE_ANON_KEY = 'eyJhbGci...'; // ‚ö†Ô∏è –í–ò–î–ï–ù –í–°–ï–ú!
   ```

2. **–ü—Ä—è–º—ã–µ PATCH –∑–∞–ø—Ä–æ—Å—ã** (—Å—Ç—Ä–æ–∫–∞ 5742):
   ```javascript
   fetch(`${SUPABASE_URL}/rest/v1/leaderboard?telegram_id=eq.${referrerId}`, {
       method: 'PATCH', // ‚ö†Ô∏è –û–ë–•–û–î–ò–¢ API!
       headers: { 'apikey': SUPABASE_ANON_KEY }
   })
   ```

## ‚úÖ –†–ï–®–ï–ù–ò–ï:

### –®–ê–ì 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Row Level Security (RLS) –≤ Supabase

**–û—Ç–∫—Ä–æ–π Supabase Dashboard ‚Üí SQL Editor ‚Üí –í—ã–ø–æ–ª–Ω–∏:**

```sql
-- –ó–∞–ø—Ä–µ—Ç–∏—Ç—å UPDATE –¥–ª—è anon —Ä–æ–ª–∏
ALTER TABLE leaderboard ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow service role updates only" ON leaderboard
    FOR UPDATE
    TO service_role
    USING (true)
    WITH CHECK (true);
```

**–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:**
```
sql/fix-leaderboard-rls-security.sql
```

### –®–ê–ì 2: –£–±—Ä–∞—Ç—å –ø—Ä—è–º—ã–µ PATCH –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –∫–ª–∏–µ–Ω—Ç–∞

‚úÖ **–£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–û:**
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç API –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ PATCH

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SUPABASE_ANON_KEY

**–§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- `tamagotchi-game.html` - —É–±—Ä–∞—Ç—å –≤—Å–µ PATCH –∑–∞–ø—Ä–æ—Å—ã –∫ leaderboard
- `admin-table.html` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤
- –í—Å–µ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã —Å –ø—Ä—è–º—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ Supabase

## üõ°Ô∏è –ó–ê–©–ò–¢–ê –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

1. ‚úÖ **RLS –∑–∞–ø—Ä–µ—Ç–∏—Ç** –ø—Ä—è–º—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ anon key
2. ‚úÖ **API –≤–∞–ª–∏–¥–∞—Ü–∏—è** –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
3. ‚úÖ **–î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç** –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. ‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç** –±—É–¥–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω (10,000 TAMA/–∑–∞–ø—Ä–æ—Å)

## ‚ö†Ô∏è –í–ê–ñ–ù–û:

**–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è RLS:**
- –í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ —á–µ—Ä–µ–∑ API
- –ü—Ä—è–º—ã–µ PATCH –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –∫–ª–∏–µ–Ω—Ç–∞ –±—É–¥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç —á–∏—Ç–µ—Ä—Å—Ç–≤–æ!

## üìã –ß–¢–û –î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°:

1. **–ó–∞–ø—É—Å—Ç–∏ SQL —Å–∫—Ä–∏–ø—Ç** –≤ Supabase SQL Editor
2. **–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ API –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å)
3. **–ò—Å–ø—Ä–∞–≤—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã** —á–µ—Ä–µ–∑ `admin-table.html` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç API)



