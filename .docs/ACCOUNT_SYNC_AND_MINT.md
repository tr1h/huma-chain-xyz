# üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –∏ –º–∏–Ω—Ç–∏–Ω–≥ NFT –∑–∞ SOL –≤ –∏–≥—Ä–µ

## üìä –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–í –∏–≥—Ä–µ:**
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Phantom Wallet (`connectPhantomWallet`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ —Å Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–º (`linkWalletToTelegramAccount`)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `wallet_address` –≤ —Ç–∞–±–ª–∏—Ü—É `leaderboard`
   - –ö–Ω–æ–ø–∫–∞ "Mint NFT" ‚Üí –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ `mint.html`

2. **–ù–∞ —Å–∞–π—Ç–µ:**
   - –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –º–∏–Ω—Ç–∏–Ω–≥–∞ NFT –∑–∞ SOL (`mint.html`)
   - –ü—Ä–æ—Å–º–æ—Ç—Ä NFT –ø–æ Telegram ID –∏–ª–∏ Wallet Address (`my-nfts.html`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ —Å Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–º

### ‚ùå –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–ú–∏–Ω—Ç–∏–Ω–≥ NFT –∑–∞ SOL –≤ –∏–≥—Ä–µ** - –Ω–µ—Ç, —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–∞–π—Ç
2. **–ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - —á–∞—Å—Ç–∏—á–Ω–∞—è, –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

---

## üéØ –†–µ—à–µ–Ω–∏–µ:

### 1. –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω—Ç–∏–Ω–≥ NFT –∑–∞ SOL –≤ –∏–≥—Ä—É

**–ì–¥–µ:** `tamagotchi-game.html` ‚Üí NFT Modal

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- –ö–Ω–æ–ø–∫–∞ "Mint with SOL" –≤ NFT –º–æ–¥–∞–ª–∫–µ
- –§—É–Ω–∫—Ü–∏—è `mintNFTWithSOL(tier)` - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `mint.html`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ –∂–µ API endpoints —á—Ç–æ –∏ –Ω–∞ —Å–∞–π—Ç–µ

**API endpoints:**
- Bronze: `/api/mint-nft-bronze-sol-rest.php`
- Silver/Gold/Platinum/Diamond: `/api/mint-nft-sol-rest.php`
- On-chain mint: `/api/mint-nft-onchain-wrapper.php`

### 2. –£–ª—É—á—à–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∫–∞–±–∏–Ω–µ—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É –∏–≥—Ä–æ–π –∏ —Å–∞–π—Ç–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
1. **–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–∞ –≤ –∏–≥—Ä–µ:**
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `wallet_address` –≤ `leaderboard`
   - –ù–∞–π—Ç–∏ –≤—Å–µ NFT —Å —ç—Ç–∏–º `wallet_address` –Ω–æ –±–µ–∑ `telegram_id`
   - –û–±–Ω–æ–≤–∏—Ç—å –∏—Ö `telegram_id` (merge orphaned NFTs)

2. **–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞ —Å–∞–π—Ç–µ:**
   - –¢–æ –∂–µ —Å–∞–º–æ–µ - –Ω–∞–π—Ç–∏ –∏ —Å–≤—è–∑–∞—Ç—å NFT

3. **–ü—Ä–∏ –º–∏–Ω—Ç–∏–Ω–≥–µ NFT:**
   - –ï—Å–ª–∏ –µ—Å—Ç—å `telegram_id` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ
   - –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å `wallet_address` –∏ –ø–æ–∑–∂–µ —Å–≤—è–∑–∞—Ç—å

---

## üîß –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω—Ç–∏–Ω–≥ NFT –∑–∞ SOL –≤ –∏–≥—Ä—É

```javascript
// –í tamagotchi-game.html, –≤ NFT modal
async function mintNFTWithSOL(tier) {
    // 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
    if (!walletConnected || !walletAddress) {
        showMessage('‚ùå Please connect wallet first!', 'error');
        await connectPhantomWallet();
        return;
    }
    
    // 2. –ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—É NFT
    const price = await getNFTPrice(tier);
    
    // 3. –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–∫–∞–∫ –≤ mint.html)
    const signature = await createAndSendDistributionTransaction(price);
    
    // 4. –í—ã–∑–≤–∞—Ç—å API –¥–ª—è –º–∏–Ω—Ç–∏–Ω–≥–∞
    const response = await fetch('https://api.solanatamagotchi.com/api/mint-nft-sol-rest.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            telegram_id: window.TELEGRAM_USER_ID,
            wallet_address: walletAddress,
            tier_name: tier,
            price_sol: price,
            transaction_signature: signature
        })
    });
    
    // 5. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    const result = await response.json();
    if (result.success) {
        showMessage(`‚úÖ ${tier} NFT minted!`, 'success');
        await loadNFTCollection(); // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é
    }
}
```

### –®–∞–≥ 2: –£–ª—É—á—à–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

```javascript
// –í tamagotchi-game.html
async function syncAccountData() {
    const telegramId = window.TELEGRAM_USER_ID;
    const wallet = walletAddress;
    
    if (!telegramId || !wallet) return;
    
    // 1. –û–±–Ω–æ–≤–∏—Ç—å wallet_address –≤ leaderboard
    await fetch(`${SUPABASE_URL}/rest/v1/leaderboard?telegram_id=eq.${telegramId}`, {
        method: 'PATCH',
        headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ wallet_address: wallet })
    });
    
    // 2. –ù–∞–π—Ç–∏ orphaned NFTs (—Å wallet_address –Ω–æ –±–µ–∑ telegram_id)
    const { data: orphanedNFTs } = await supabase
        .from('user_nfts')
        .select('*')
        .eq('wallet_address', wallet)
        .is('telegram_id', null);
    
    // 3. –û–±–Ω–æ–≤–∏—Ç—å –∏—Ö telegram_id
    if (orphanedNFTs && orphanedNFTs.length > 0) {
        for (const nft of orphanedNFTs) {
            await supabase
                .from('user_nfts')
                .update({ telegram_id: telegramId })
                .eq('id', nft.id)
                .execute();
        }
        console.log(`‚úÖ Linked ${orphanedNFTs.length} orphaned NFTs to Telegram account`);
    }
    
    // 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å TAMA –±–∞–ª–∞–Ω—Å
    await syncTAMABalance();
}

async function syncTAMABalance() {
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏–∑ –±–∞–∑—ã –∏ –æ–±–Ω–æ–≤–∏—Ç—å gameState
    const { data } = await supabase
        .from('leaderboard')
        .select('tama')
        .eq('telegram_id', window.TELEGRAM_USER_ID)
        .single();
    
    if (data && data.tama !== undefined) {
        gameState.tama = data.tama;
        updateUI();
    }
}
```

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `mintNFTWithSOL()` –≤ `tamagotchi-game.html`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –º–∏–Ω—Ç–∏–Ω–≥–∞ –≤ NFT modal
3. ‚úÖ –£–ª—É—á—à–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `linkWalletToTelegramAccount()` –¥–ª—è –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–≥—Ä—ã
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é TAMA –±–∞–ª–∞–Ω—Å–∞

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **–£–¥–æ–±—Å—Ç–≤–æ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –º–∏–Ω—Ç–∏—Ç—å NFT –ø—Ä—è–º–æ –≤ –∏–≥—Ä–µ
2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã
3. **–ï–¥–∏–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç:** –ò–≥—Ä–∞ –∏ —Å–∞–π—Ç –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ
4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–≤—è–∑—ã–≤–∞—Ç—å –∫–æ—à–µ–ª—å–∫–∏

---

**–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é?**

