# üõí –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–¥–∞–∂–∏ NFT –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ

## üìã –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–¥–∞–∂–∞ NFT:

### **1. –†–∞–∑–º–µ—â–µ–Ω–∏–µ NFT –Ω–∞ –ø—Ä–æ–¥–∞–∂—É (SELL):**

**–®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç NFT**
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "List NFT for Sale"
- –í—ã–±–∏—Ä–∞–µ—Ç NFT –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–≤–æ–∏—Ö NFT
- –í—ã–±–∏—Ä–∞–µ—Ç —Ç–∏–ø –æ–ø–ª–∞—Ç—ã: TAMA, SOL, –∏–ª–∏ –æ–±–∞

**–®–∞–≥ 2: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ü–µ–Ω—É**
- –î–ª—è TAMA: –º–∏–Ω–∏–º—É–º 1,000 TAMA
- –î–ª—è SOL: –º–∏–Ω–∏–º—É–º 0.001 SOL
- –ú–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞

**–®–∞–≥ 3: API —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ**
```javascript
POST /api/tama/marketplace/list
{
  telegram_id: "123456789",
  nft_id: 154,
  payment_type: "sol",
  price_sol: 1.0
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `marketplace_listings`:
   - `nft_id` - ID NFT
   - `seller_telegram_id` - ID –ø—Ä–æ–¥–∞–≤—Ü–∞
   - `price_tama` –∏–ª–∏ `price_sol` - —Ü–µ–Ω–∞
   - `payment_type` - —Ç–∏–ø –æ–ø–ª–∞—Ç—ã
   - `status` = 'active'

2. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `user_nfts`:
   - `is_listed` = true

3. ‚úÖ NFT –æ—Å—Ç–∞–µ—Ç—Å—è —É –ø—Ä–æ–¥–∞–≤—Ü–∞ –¥–æ –ø–æ–∫—É–ø–∫–∏

---

### **2. –ü–æ–∫—É–ø–∫–∞ NFT (BUY):**

**–®–∞–≥ 1: –ü–æ–∫—É–ø–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç NFT**
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ NFT –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ
- –ù–∞–∂–∏–º–∞–µ—Ç "Buy Now" –Ω–∞ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–µ–º—Å—è NFT

**–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞**
- –î–ª—è TAMA: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å TAMA –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
- –î–ª—è SOL: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Phantom wallet

**–®–∞–≥ 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏**
- –ü–æ–∫—É–ø–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–∫—É–ø–∫—É
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –≤ API

```javascript
POST /api/tama/marketplace/buy
{
  telegram_id: "987654321",
  listing_id: 1,
  payment_type: "sol"  // –∏–ª–∏ "tama"
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ API (`handleMarketplaceBuy`):**

#### **–î–ª—è TAMA –ø–ª–∞—Ç–µ–∂–µ–π:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
2. ‚úÖ –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ (5% –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
3. ‚úÖ –ü–µ—Ä–µ–≤–æ–¥ TAMA:
   - –°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –±–∞–ª–∞–Ω—Å–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è: `price_tama`
   - –ó–∞—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–æ–¥–∞–≤—Ü—É: `price_tama - 5%`
4. ‚úÖ **–ü–µ—Ä–µ–¥–∞—á–∞ NFT:**
   ```php
   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ owner –≤ user_nfts
   UPDATE user_nfts 
   SET telegram_id = buyer_telegram_id, 
       is_listed = false 
   WHERE id = nft_id
   ```
5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:
   - `status` = 'sold'
   - `buyer_telegram_id` = –ø–æ–∫—É–ø–∞—Ç–µ–ª—å
   - `sold_at` = —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
6. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `marketplace_sales`
7. ‚úÖ –ó–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ `transactions`

#### **–î–ª—è SOL –ø–ª–∞—Ç–µ–∂–µ–π:**
1. ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è `buyer_wallet` –∏ `seller_wallet`
2. ‚úÖ –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ (5% –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
3. ‚ö†Ô∏è **SOL –ø–µ—Ä–µ–≤–æ–¥ (TODO):**
   - –°–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –±–∞–∑—É
   - –ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Phantom wallet –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ SOL
4. ‚úÖ **–ü–µ—Ä–µ–¥–∞—á–∞ NFT:**
   - –¢–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –¥–ª—è TAMA
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `telegram_id` –≤ `user_nfts`
5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –ø—Ä–æ–¥–∞–∂–µ

---

## üîÑ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å NFT:

### **Off-chain NFT (—Ç–æ–ª—å–∫–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö):**
- ‚úÖ –ú–µ–Ω—è–µ—Ç—Å—è `telegram_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `user_nfts`
- ‚úÖ NFT –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –Ω–æ–≤–æ–º—É –≤–ª–∞–¥–µ–ª—å—Ü—É
- ‚úÖ `is_listed` = false

### **On-chain NFT (–Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ):**
- ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –°–µ–π—á–∞—Å NFT –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚ö†Ô∏è **–ù–∞ –±–ª–æ–∫—á–µ–π–Ω–µ NFT –æ—Å—Ç–∞–µ—Ç—Å—è —É —Å—Ç–∞—Ä–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞!**
- üîß **–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:** On-chain transfer NFT —á–µ—Ä–µ–∑ Metaplex

---

## üí∞ –ö–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:

- **5%** —Å –∫–∞–∂–¥–æ–π –ø—Ä–æ–¥–∞–∂–∏
- –ü—Ä–æ–¥–∞–≤–µ—Ü –ø–æ–ª—É—á–∞–µ—Ç **95%**
- –ö–æ–º–∏—Å—Å–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `marketplace_sales`

---

## üìä –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂:

–í—Å–µ –ø—Ä–æ–¥–∞–∂–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `marketplace_sales`:
- –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥–∞–∂–∏ (—Ü–µ–Ω–∞, –∫–æ–º–∏—Å—Å–∏—è, –ø–æ–ª—É—á–∞—Ç–µ–ª—å)
- –¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞ (TAMA –∏–ª–∏ SOL)
- –í—Ä–µ–º—è –ø—Ä–æ–¥–∞–∂–∏
- –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

1. **SOL –ø–ª–∞—Ç–µ–∂–∏:**
   - SOL –Ω–µ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Phantom wallet
   - –¢—Ä–µ–±—É–µ—Ç—Å—è on-chain —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

2. **On-chain NFT:**
   - NFT –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - –ù–∞ –±–ª–æ–∫—á–µ–π–Ω–µ –æ—Å—Ç–∞–µ—Ç—Å—è —É —Å—Ç–∞—Ä–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞
   - –ù—É–∂–µ–Ω on-chain transfer —á–µ—Ä–µ–∑ Metaplex

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ù–µ—Ç escrow (—É—Å–ª–æ–≤–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞)
   - –ü—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **On-chain NFT transfer:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Metaplex –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ NFT –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ
   - –û–±–Ω–æ–≤–∏—Ç—å `updateAuthority` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

2. **SOL –ø–ª–∞—Ç–µ–∂–∏:**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Phantom wallet
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ SOL
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–æ–∫—É–ø–∫–∏

3. **Escrow —Å–∏—Å—Ç–µ–º–∞:**
   - –£—Å–ª–æ–≤–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏

