# üîí –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: site_visits —Ç–∞–±–ª–∏—Ü–∞

## ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨: –ú—ã –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—Ä—É—à–∞–µ–º!

### üìä –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `site_visits`:

1. **–ü—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ):**
   - `page_url` - URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
   - `referrer` - –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ø—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
   - `user_agent` - –±—Ä–∞—É–∑–µ—Ä –∏ OS (–ø—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
   - `device_type` - —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (mobile/desktop/tablet)
   - `browser` - –Ω–∞–∑–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
   - `os` - –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
   - `session_id` - —Å–ª—É—á–∞–π–Ω—ã–π ID —Å–µ—Å—Å–∏–∏ (–Ω–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
   - `visit_date`, `visit_time` - –≤—Ä–µ–º—è –ø–æ—Å–µ—â–µ–Ω–∏—è

2. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   - `ip_address` - IP –∞–¥—Ä–µ—Å (–º–æ–∂–µ—Ç –±—ã—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º)
   - `country`, `city` - –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

## üõ°Ô∏è –ß—Ç–æ –º—ã –ù–ï –Ω–∞—Ä—É—à–∞–µ–º:

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü:
- **leaderboard** - –∑–∞—â–∏—â–µ–Ω–∞ RLS (—Ç–æ–ª—å–∫–æ –¥–ª—è authenticated)
- **user_nfts** - –∑–∞—â–∏—â–µ–Ω–∞ RLS (—Ç–æ–ª—å–∫–æ –¥–ª—è authenticated)
- **transactions** - –∑–∞—â–∏—â–µ–Ω–∞ RLS (—Ç–æ–ª—å–∫–æ –¥–ª—è authenticated)
- **referrals** - –∑–∞—â–∏—â–µ–Ω–∞ RLS (—Ç–æ–ª—å–∫–æ –¥–ª—è authenticated)

### ‚úÖ RLS –≤—Å–µ –µ—â–µ –≤–∫–ª—é—á–µ–Ω:
- Row Level Security **–∞–∫—Ç–∏–≤–µ–Ω** –¥–ª—è `site_visits`
- –ü—Ä–æ—Å—Ç–æ —Ä–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–∞–≤–∞ —á—Ç–µ–Ω–∏—è –¥–ª—è **–ø—É–±–ª–∏—á–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö**
- INSERT –≤—Å–µ –µ—â–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è (—Ç–æ–ª—å–∫–æ anon –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å)

### ‚úÖ –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º:
- –ù–µ—Ç `telegram_id`
- –ù–µ—Ç `wallet_address`
- –ù–µ—Ç `email` –∏–ª–∏ –¥—Ä—É–≥–∏—Ö PII
- –ù–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üìã –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:

### –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –≤–µ–±-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏:
- Google Analytics - –ø—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ API
- –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ - –ø—É–±–ª–∏—á–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
- –í—Å–µ –≤–µ–±-–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å–µ—â–µ–Ω–∏–π

### –ß—Ç–æ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —á–µ—Ä–µ–∑ `anon` SELECT:
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–µ—â–µ–Ω–∏–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º/–±—Ä–∞—É–∑–µ—Ä–∞–º
- –í—Ä–µ–º—è –ø–æ—Å–µ—â–µ–Ω–∏–π
- URL —Å—Ç—Ä–∞–Ω–∏—Ü (–ø—É–±–ª–∏—á–Ω—ã–µ)

### –ß—Ç–æ –ù–ï–õ–¨–ó–Ø —É–≤–∏–¥–µ—Ç—å:
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü
- –†–µ–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üîê –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

### –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É—Å–∏–ª–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å IP –∞–¥—Ä–µ—Å–æ–≤:

```sql
-- –•–µ—à–∏—Ä–æ–≤–∞—Ç—å IP –∞–¥—Ä–µ—Å–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
-- (–Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å api/track-visit.php)
```

–ò–ª–∏ –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å IP –∏–∑ SELECT –¥–ª—è anon:

```sql
-- –°–æ–∑–¥–∞—Ç—å view –±–µ–∑ IP –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
CREATE VIEW site_visits_public AS
SELECT 
    id,
    visit_date,
    visit_time,
    page_url,
    referrer,
    device_type,
    browser,
    os,
    session_id
FROM site_visits;

-- Policy –¥–ª—è view
CREATE POLICY "Allow anon reads public view" ON site_visits_public
    FOR SELECT
    TO anon
    USING (true);
```

---

## ‚úÖ –í—ã–≤–æ–¥: –ë–ï–ó–û–ü–ê–°–ù–û!

### –ü–æ—á–µ–º—É —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ:

1. ‚úÖ **–¢–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** - –Ω–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
2. ‚úÖ **RLS –≤–∫–ª—é—á–µ–Ω** - –∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ **–î—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã** - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –¥–∞–Ω–Ω—ã–º
4. ‚úÖ **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞** - —Ç–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –≤—Å–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã
5. ‚úÖ **–ü—É–±–ª–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ —Å–∞–π—Ç–∞

### –ß—Ç–æ –º—ã –¥–µ–ª–∞–µ–º:
- –†–∞–∑—Ä–µ—à–∞–µ–º —á—Ç–µ–Ω–∏–µ **–ø—É–±–ª–∏—á–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** —á–µ—Ä–µ–∑ `anon` –∫–ª—é—á
- –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
- –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

**–ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è!** 

–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –≤–µ–±-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É –¥–ª—è IP –∞–¥—Ä–µ—Å–æ–≤, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å view –∏–ª–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

