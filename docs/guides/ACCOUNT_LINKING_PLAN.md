# ğŸ”— ĞŸĞ»Ğ°Ğ½ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Telegram + Wallet ÑĞ¸ÑÑ‚ĞµĞ¼

## ğŸš¨ Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:

### 1. ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° TAMA Ğ² URL (ĞĞ•Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞ!)
```
âŒ mint.html?user_id=202140267&tama=42705&level=8&xp=609
                              â†‘ ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ!
```

### 2. Ğ”Ğ²Ğµ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:
- `leaderboard` (Telegram users)
- `wallet_users` (Wallet users)

### 3. Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:
- Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°ÑˆĞµĞ» Ñ‡ĞµÑ€ĞµĞ· Telegram â†’ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² `leaderboard`
- Ğ•ÑĞ»Ğ¸ Ğ·Ğ°ÑˆĞµĞ» Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾ÑˆĞµĞ»ĞµĞº â†’ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² `wallet_users`
- Ğ•ÑĞ»Ğ¸ ÑĞ²ÑĞ·Ğ°Ğ» Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹ â†’ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ´Ğ²ÑƒÑ… Ğ¼ĞµÑÑ‚Ğ°Ñ…!

---

## âœ… Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•: Unified Balance System

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PRIMARY SOURCE: leaderboard         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ telegram_id (PRIMARY KEY)            â”‚   â”‚
â”‚  â”‚ tama (PRIMARY BALANCE)               â”‚   â”‚
â”‚  â”‚ level, xp, game_state                â”‚   â”‚
â”‚  â”‚ wallet_address (LINKED WALLET)  âœ…   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
                    â†“ Link
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       SECONDARY: wallet_users (sync)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ wallet_address (PRIMARY KEY)             â”‚
â”‚  â”‚ telegram_id (LINK)  âœ…                   â”‚
â”‚  â”‚ tama_balance (SYNCED from leaderboard)   â”‚
â”‚  â”‚ username, clicks                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ°:

1. **LEADERBOARD = Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿Ñ€Ğ°Ğ²Ğ´Ñ‹**
   - Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ TAMA Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ·Ğ´ĞµÑÑŒ
   - Telegram ID = Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€

2. **WALLET_USERS = Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ**
   - Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ wallet_address
   - Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ñ leaderboard
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ wallet-only Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

3. **Ğ¡Ğ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ:**
   - Telegram user â†’ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ğ» ĞºĞ¾ÑˆĞµĞ»ĞµĞº â†’ `leaderboard.wallet_address = "Hg8k..."`
   - Wallet user â†’ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ğ» Telegram â†’ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² `leaderboard`

---

## ğŸ› ï¸ Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:

### 1. Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ `tama` Ğ¸Ğ· URL

**Ğ‘Ğ«Ğ›Ğ:**
```javascript
window.location.href = `mint.html?user_id=${userId}&tama=${tama}&level=${level}`;
```

**Ğ¡Ğ¢ĞĞĞ•Ğ¢:**
```javascript
// Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ user_id! Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ· Ğ‘Ğ”
window.location.href = `mint.html?user_id=${userId}`;
```

### 2. Unified API endpoint

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `/api/unified-balance.php`:
```php
GET /api/unified-balance.php?user_id=202140267

Response:
{
  "success": true,
  "telegram_id": 202140267,
  "wallet_address": "H4p6U5oP5V2tvTyL1URfEjUVk8ni6diujzWniqFiHCZ9",
  "tama": 42705,
  "level": 8,
  "account_type": "linked"  // telegram_only | wallet_only | linked
}
```

### 3. ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ

**ĞšĞ¾Ğ³Ğ´Ğ° Telegram user Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ ĞºĞ¾ÑˆĞµĞ»ĞµĞº:**
```javascript
async function linkWallet(walletAddress) {
  // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ leaderboard
  await supabase
    .from('leaderboard')
    .update({ wallet_address: walletAddress })
    .eq('telegram_id', TELEGRAM_USER_ID);
  
  // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ wallet_users
  await supabase
    .from('wallet_users')
    .upsert({
      wallet_address: walletAddress,
      telegram_id: TELEGRAM_USER_ID,
      tama_balance: tamaFromLeaderboard  // ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ
    });
}
```

---

## ğŸ“Š ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:

### Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸:

```sql
-- 1. Ğ”Ğ»Ñ Ğ²ÑĞµÑ… wallet_users Ñ telegram_id - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ leaderboard
UPDATE leaderboard l
SET wallet_address = w.wallet_address
FROM wallet_users w
WHERE l.telegram_id = w.telegram_id
  AND w.telegram_id IS NOT NULL
  AND l.wallet_address IS NULL;

-- 2. Ğ”Ğ»Ñ Ğ²ÑĞµÑ… wallet_only users - ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² leaderboard
INSERT INTO leaderboard (telegram_id, tama, level, username, wallet_address)
SELECT 
  999999900 + row_number() OVER () as telegram_id,  -- Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ ID
  tama_balance as tama,
  level,
  username,
  wallet_address
FROM wallet_users
WHERE telegram_id IS NULL;

-- 3. Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ»Ğ°Ğ½ÑÑ‹ (leaderboard = Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿Ñ€Ğ°Ğ²Ğ´Ñ‹)
UPDATE wallet_users w
SET tama_balance = l.tama
FROM leaderboard l
WHERE w.telegram_id = l.telegram_id
  AND w.telegram_id IS NOT NULL;
```

---

## ğŸ¯ Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:

### Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ:

1. **Ğ—Ğ°ÑˆĞµĞ» Ñ‡ĞµÑ€ĞµĞ· Telegram:**
   - Ğ˜Ğ³Ñ€Ğ°ĞµÑ‚ Ğ² Ğ±Ğ¾Ñ‚Ğµ
   - Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ² `leaderboard`
   - ĞœĞ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾ÑˆĞµĞ»ĞµĞº â†’ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ

2. **Ğ—Ğ°ÑˆĞµĞ» Ñ‡ĞµÑ€ĞµĞ· ÑĞ°Ğ¹Ñ‚ (ĞºĞ¾ÑˆĞµĞ»ĞµĞº):**
   - ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ğ» Phantom
   - Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Telegram ID â†’ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ¸Ğ· `leaderboard`
   - Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ â†’ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚ Ğ² `wallet_users`

3. **Ğ¡Ğ²ÑĞ·Ğ°Ğ» Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹:**
   - ĞĞ´Ğ¸Ğ½ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ TAMA Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ… ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ¾Ğ²
   - ĞœĞ¾Ğ¶ĞµÑ‚ Ğ¸Ğ³Ñ€Ğ°Ñ‚ÑŒ Ğ¾Ñ‚ĞºÑƒĞ´Ğ° ÑƒĞ³Ğ¾Ğ´Ğ½Ğ¾
   - Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸

### Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ:

- âœ… ĞĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ° Ğ² URL
- âœ… Ğ’ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ‘Ğ” (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼Ğ¾)
- âœ… ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ
- âœ… ĞĞ´Ğ¸Ğ½ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿Ñ€Ğ°Ğ²Ğ´Ñ‹ (leaderboard)

---

## ğŸ“ Next Steps:

1. âœ… Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ `tama` Ğ¸Ğ· Ğ²ÑĞµÑ… URL
2. âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `/api/unified-balance.php`
3. âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ mint.html Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ unified API
4. âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ tamagotchi-game.html Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ
5. âœ… ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
6. âœ… Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ±Ğ¾Ğ¸Ñ… flow (Telegram â†’ Wallet, Wallet â†’ Telegram)

