<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        input, button {
            padding: 10px;
            margin: 5px;
            font-size: 16px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #5568d3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 600px;
            overflow-y: auto;
        }
        .suspicious {
            color: red;
            font-weight: bold;
        }
        .ok {
            color: green;
        }
        .warning {
            color: orange;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
        <div>
            <input type="text" id="username" placeholder="Username" value="L'arc">
            <button onclick="analyzeUser()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        async function analyzeUser() {
            const username = document.getElementById('username').value;
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';

            try {
                const response = await fetch(`https://api.solanatamagotchi.com/api/analyze-user.php?username=${encodeURIComponent(username)}`);
                const data = await response.json();

                if (data.error) {
                    resultDiv.innerHTML = `<span class="suspicious">‚ùå –û—à–∏–±–∫–∞: ${data.error}</span>`;
                    return;
                }

                let html = '<h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h2>\n\n';
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                html += `<h3>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</h3>`;
                html += `ID: ${data.user.telegram_id}\n`;
                html += `Username: ${data.user.username}\n`;
                html += `–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: ${data.user.current_balance.toLocaleString()} TAMA\n`;
                html += `–£—Ä–æ–≤–µ–Ω—å: ${data.user.level}\n`;
                html += `–í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${data.user.total_transactions}\n\n`;

                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—Ä–∞–±–æ—Ç–∫–∞
                html += `<h3>üí∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h3>`;
                html += `–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${data.earnings.total_earned.toLocaleString()} TAMA\n`;
                html += `–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ: ${data.earnings.total_spent.toLocaleString()} TAMA\n`;
                html += `–ß–∏—Å—Ç—ã–π –±–∞–ª–∞–Ω—Å (—Ä–∞—Å—á–µ—Ç–Ω—ã–π): ${data.earnings.net_balance.toLocaleString()} TAMA\n`;
                const balanceDiff = Math.abs(data.user.current_balance - data.earnings.net_balance);
                const diffPercent = data.earnings.net_balance > 0 ? ((balanceDiff / data.earnings.net_balance) * 100).toFixed(1) : 'N/A';
                const isSuspicious = balanceDiff > 1000 || (data.earnings.net_balance > 0 && balanceDiff / data.earnings.net_balance > 0.1);
                const diffClass = isSuspicious ? 'suspicious' : 'ok';
                html += `<span class="${diffClass}">–†–∞–∑–Ω–∏—Ü–∞ —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º: ${balanceDiff.toLocaleString()} TAMA (${diffPercent}%)</span>\n`;
                if (isSuspicious) {
                    html += `<span class="suspicious">‚ö†Ô∏è –ü–û–î–û–ó–†–ò–¢–ï–õ–¨–ù–û! –ë–∞–ª–∞–Ω—Å –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º!</span>\n`;
                }
                html += '\n';

                // –ü–æ —Ç–∏–ø–∞–º
                html += `<h3>üìà –ü–æ —Ç–∏–ø–∞–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:</h3>`;
                for (const [type, stats] of Object.entries(data.earnings.by_type)) {
                    html += `${type}: ${stats.count} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, ${stats.total.toLocaleString()} TAMA\n`;
                }
                html += '\n';

                // –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
                html += `<h3>üö® –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (${data.suspicious_patterns.length}):</h3>`;
                if (data.suspicious_patterns.length === 0) {
                    html += `<span class="ok">‚úÖ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!</span>\n\n`;
                } else {
                    data.suspicious_patterns.forEach((pattern, i) => {
                        const severityClass = pattern.severity === 'high' ? 'suspicious' : 'warning';
                        html += `<span class="${severityClass}">${i+1}. [${pattern.severity.toUpperCase()}] ${pattern.type}</span>\n`;
                        html += `   –î–∞—Ç–∞: ${pattern.date}\n`;
                        html += `   ${pattern.description}\n`;
                        if (pattern.amount) html += `   –°—É–º–º–∞: ${pattern.amount.toLocaleString()} TAMA\n`;
                        html += '\n';
                    });
                }

                // –ö—Ä—É–ø–Ω–µ–π—à–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                html += `<h3>üíé –ö—Ä—É–ø–Ω–µ–π—à–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Ç–æ–ø 10):</h3>`;
                data.largest_transactions.slice(0, 10).forEach((tx, i) => {
                    html += `${i+1}. ${tx.date}: ${tx.type} - ${tx.amount.toLocaleString()} TAMA (–±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ: ${tx.balance_after.toLocaleString()})\n`;
                });
                html += '\n';

                // –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –¥–Ω—è–º
                html += `<h3>üìÖ –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –¥–Ω—è–º (—Ç–æ–ø 10 –¥–Ω–µ–π):</h3>`;
                const dailyEntries = Object.entries(data.daily_breakdown)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10);
                dailyEntries.forEach(([date, amount]) => {
                    const isSuspicious = amount > 10000;
                    const className = isSuspicious ? 'suspicious' : 'ok';
                    html += `<span class="${className}">${date}: ${amount.toLocaleString()} TAMA</span>\n`;
                });

                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.innerHTML = `<span class="suspicious">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            analyzeUser();
        };
    </script>
</body>
</html>

