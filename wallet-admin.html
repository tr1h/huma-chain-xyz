<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Wallet Admin - Solana Tamagotchi</title>
    <style>
        /* Logo Styles üé® */
        .game-logo {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 10000;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .game-logo:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }

        .game-logo img {
            height: 50px;
            width: auto;
            display: block;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 5px;
        }

        @media (max-width: 768px) {
            .game-logo {
                top: 10px;
                left: 10px;
            }

            .game-logo img {
                height: 40px;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 30px;
            color: #856404;
        }
        
        .warning strong {
            display: block;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .wallet-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .wallet-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .wallet-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .wallet-info {
            margin-bottom: 10px;
        }
        
        .wallet-info label {
            font-weight: bold;
            color: #666;
            display: block;
            margin-bottom: 5px;
        }
        
        .wallet-info .value {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 8px;
            border-radius: 5px;
            word-break: break-all;
            font-size: 0.9em;
        }
        
        .wallet-info .address {
            color: #667eea;
            cursor: pointer;
        }
        
        .wallet-info .address:hover {
            text-decoration: underline;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .status.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status.locked {
            background: #f8d7da;
            color: #721c24;
        }
        
        .actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-content h2 {
            margin-bottom: 20px;
            color: #667eea;
        }
        
        .modal-content input,
        .modal-content textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .modal-content textarea {
            min-height: 100px;
            font-family: 'Courier New', monospace;
        }
        
        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }
        
        .close:hover {
            color: #333;
        }
        
        .stats {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .stats h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-item .label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .stat-item .value {
            color: #667eea;
            font-size: 1.5em;
            font-weight: bold;
        }
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
        }
        
        .login-box h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .login-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 15px;
        }
        
        .login-box button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
        }
        
        .login-box button:hover {
            background: #5568d3;
        }
        
        .login-error {
            color: #dc3545;
            margin-top: 10px;
            text-align: center;
            font-size: 0.9em;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
    <script src="wallet-admin-password.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-sha256@0.11.0/src/sha256.min.js"></script>
</head>
<body>
    <!-- Logo üé® -->
    <a href="index.html" class="game-logo" title="Back to Home">
        <img src="logo.png" alt="Solana Tamagotchi">
    </a>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h2>üîê Admin Access</h2>
            <p style="color: #666; margin-bottom: 20px; text-align: center;">Enter password to access wallet admin panel</p>
            <input type="password" id="passwordInput" placeholder="Enter admin password" autocomplete="off">
            <button onclick="checkPassword()">üîì Unlock</button>
            <div id="loginError" class="login-error"></div>
            <div style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 0.85em; color: #666;">
                <strong>‚ÑπÔ∏è Security:</strong><br>
                ‚Ä¢ Password stored locally only<br>
                ‚Ä¢ Session expires in 30 minutes<br>
                ‚Ä¢ All operations logged
            </div>
        </div>
    </div>
    
    <!-- Main Content (hidden until authenticated) -->
    <div id="mainContent" class="hidden">
    <div class="container">
        <h1>üîê Wallet Admin Panel</h1>
        <p class="subtitle">Solana Tamagotchi - Secure Key Management</p>
        
        <div class="warning">
            <strong>‚ö†Ô∏è –í–ê–ñ–ù–û: –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>–≠—Ç–∞ –ø–∞–Ω–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –Ω–∞ localhost (–Ω–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ!)</li>
                <li>–ö–ª—é—á–∏ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç</li>
                <li>–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ</li>
                <li>–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ keypair —Ñ–∞–π–ª—ã –≤ Git!</li>
            </ul>
        </div>
        
        <div style="background: #d1ecf1; border: 2px solid #0c5460; border-radius: 10px; padding: 15px; margin-bottom: 30px; color: #0c5460;">
            <strong>‚ÑπÔ∏è KEYPAIR FILES LOCATION:</strong>
            <div style="margin-top: 10px; font-family: 'Courier New', monospace; background: white; padding: 10px; border-radius: 5px;">
                <strong>Path:</strong> C:\goooog\<br>
                <strong>Files:</strong><br>
                ‚Ä¢ payer-keypair.json (used by API for distribution)<br>
                ‚Ä¢ p2e-pool-keypair.json<br>
                ‚Ä¢ team-wallet-keypair.json<br>
                ‚Ä¢ marketing-wallet-keypair.json<br>
                ‚Ä¢ liquidity-pool-keypair.json<br>
                ‚Ä¢ community-wallet-keypair.json<br>
                ‚Ä¢ reserve-wallet-keypair.json<br>
                ‚Ä¢ tama-mint-keypair.json
            </div>
            <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; color: #856404;">
                <strong>üì§ Distribution:</strong> API automatically uses <code>payer-keypair.json</code> - no need to load keypairs!<br>
                <strong>üí∞ Balance Check:</strong> Optional - load keypair to check balance (stored in browser memory only)
            </div>
        </div>
        
        <div style="background: #f0f8ff; border: 2px solid #4a90e2; border-radius: 10px; padding: 15px; margin-bottom: 30px; color: #2c3e50;">
            <strong>üîç PAYER WALLET INFO:</strong>
            <div style="margin-top: 10px; font-family: 'Courier New', monospace; background: white; padding: 10px; border-radius: 5px;">
                <strong>Address:</strong> <code>8s88JVHG8Cb6HGKi25rjnMA19MuW723M6pJRDW3maDVi</code><br>
                <strong>File:</strong> payer-keypair.json<br>
                <strong>Role:</strong> Mint Authority & Transaction Payer
            </div>
            <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; color: #856404;">
                <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong><br>
                ‚Ä¢ –ü—Ä–∏ –º–∏–Ω—Ç–µ —Ç–æ–∫–µ–Ω–æ–≤ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å<br>
                ‚Ä¢ –ù–æ –æ–±—ã—á–Ω–æ –∏—Ö –Ω—É–∂–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ –¥—Ä—É–≥–∏–º –∫–æ—à–µ–ª—å–∫–∞–º (P2E Pool, Team, etc.)<br>
                ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "Check Balance" –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ Payer, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å<br>
                ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "Mint Tokens" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤<br>
                ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "Distribute" –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –¥—Ä—É–≥–∏–µ –∫–æ—à–µ–ª—å–∫–∏
            </div>
            <button onclick="checkBalance('8s88JVHG8Cb6HGKi25rjnMA19MuW723M6pJRDW3maDVi', 'Payer')" style="margin-top: 10px; background: #4a90e2; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                üí∞ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å Payer
            </button>
            <button onclick="viewLogs()" style="margin-top: 10px; background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
            </button>
            <button onclick="loadTokenHolders()" style="margin-top: 10px; background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                üìä –í—Å–µ –¥–µ—Ä–∂–∞—Ç–µ–ª–∏ TAMA
            </button>
            <button onclick="loadPoolsDistribution()" style="margin-top: 10px; background: #ff6b35; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                üí∞ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—É–ª–∞–º
            </button>
        </div>
        
        <div class="stats">
            <h2>üìä Total Distribution</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="label">Total Supply (Real)</div>
                    <div class="value" id="totalSupply">Loading...</div>
                    <button onclick="updateStats()" style="margin-top: 5px; padding: 5px 10px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.8em;">
                        üîÑ Refresh
                    </button>
                </div>
                <div class="stat-item">
                    <div class="label">üî• Burned (Total)</div>
                    <div class="value" id="totalBurned" style="color: #ef4444;">Loading...</div>
                </div>
                <div class="stat-item">
                    <div class="label">üí´ Circulating Supply</div>
                    <div class="value" id="circulatingSupply" style="color: #10b981; font-weight: bold;">Loading...</div>
                    <div style="font-size: 0.75em; color: #666; margin-top: 5px;">Total - Burned</div>
                </div>
                <div class="stat-item">
                    <div class="label">Distributed</div>
                    <div class="value" id="totalDistributed">0</div>
                </div>
                <div class="stat-item">
                    <div class="label">Remaining</div>
                    <div class="value" id="totalRemaining">1,000M</div>
                </div>
            </div>
        </div>
        
        <div class="wallet-grid" id="walletGrid">
            <!-- Wallets will be loaded here -->
        </div>
    </div>
    
    <!-- Modal for keypair upload -->
    <div class="modal" id="keypairModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Upload Keypair</h2>
            <p><strong>Keypair Location:</strong></p>
            <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-family: 'Courier New', monospace; font-size: 0.9em;">
                C:\goooog\<span id="keypairFileName">keypair.json</span>
            </div>
            <p>Select keypair file (JSON format):</p>
            <input type="file" id="keypairFile" accept=".json">
            <div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-left: 4px solid #2196F3; border-radius: 5px;">
                <p style="margin: 0; color: #666; font-size: 0.9em;">
                    <strong>‚ÑπÔ∏è Note:</strong><br>
                    ‚Ä¢ Keypair stored in browser memory only (not sent to server)<br>
                    ‚Ä¢ Used for balance checks and viewing<br>
                    ‚Ä¢ <strong>Distribution uses payer-keypair.json automatically</strong> (no need to load)
                </p>
            </div>
            <button onclick="loadKeypair()">Load Keypair</button>
            <button onclick="closeModal()" style="background: #6c757d; margin-left: 10px;">Cancel</button>
        </div>
    </div>
    
    <!-- Modal for balance check -->
    <div class="modal" id="balanceModal">
        <div class="modal-content">
            <span class="close" onclick="closeBalanceModal()">&times;</span>
            <h2>Check Balance</h2>
            <div id="balanceResult"></div>
        </div>
    </div>
    
    <!-- Modal for token minting -->
    <div class="modal" id="mintModal">
        <div class="modal-content">
            <span class="close" onclick="closeMintModal()">&times;</span>
            <h2>ü™ô Mint New Tokens</h2>
            <div id="mintContent">
                <div style="margin-bottom: 15px; padding: 10px; background: #fff3cd; border-radius: 5px; color: #856404;">
                    <strong>‚ö†Ô∏è Mint Authority:</strong> Creating new TAMA tokens from mint address<br>
                    <small>Mint Address: <code>Fuqw8Zg17XhHGXfghLYD1fqjxJa1PnmG2MmoqG5pcmLY</code></small>
                </div>
                <div style="margin-bottom: 15px;">
                    <label><strong>To Wallet:</strong></label>
                    <select id="mintToWallet" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; margin-top: 5px;">
                        <option value="">Select recipient wallet...</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label><strong>Amount (TAMA):</strong></label>
                    <input type="number" id="mintAmount" placeholder="Enter amount" min="1" step="1" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; margin-top: 5px;">
                </div>
                <div id="mintResult" style="margin-top: 15px;"></div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button onclick="executeMint()" class="btn-success" style="flex: 1; background: #ff9800;">ü™ô Mint Tokens</button>
                    <button onclick="closeMintModal()" style="background: #6c757d; flex: 1;">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for sending tokens from wallet -->
    <div class="modal" id="sendModal">
        <div class="modal-content">
            <span class="close" onclick="closeSendModal()">&times;</span>
            <h2>üí∏ Send Tokens</h2>
            <div id="sendContent">
                <div style="margin-bottom: 15px;">
                    <label><strong>From Wallet:</strong></label>
                    <div style="font-family: 'Courier New', monospace; background: #f8f9fa; padding: 8px; border-radius: 5px; margin-top: 5px;" id="sendFromWallet"></div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label><strong>To Wallet (Address or Select):</strong></label>
                    <input type="text" id="sendToWallet" placeholder="Enter wallet address or select from list" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; margin-top: 5px; margin-bottom: 5px;">
                    <select id="sendToWalletSelect" onchange="document.getElementById('sendToWallet').value = this.value" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em;">
                        <option value="">Or select from project wallets...</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px; padding: 10px; background: #e7f3ff; border-left: 4px solid #2196F3; border-radius: 5px;">
                    <p style="margin: 0; color: #666; font-size: 0.9em;">
                        <strong>‚ÑπÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞:</strong><br>
                        ‚Ä¢ –¢–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è —Å –±–∞–ª–∞–Ω—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è<br>
                        ‚Ä¢ <strong>–ë–∞–ª–∞–Ω—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –£–ú–ï–ù–¨–®–ê–ï–¢–°–Ø</strong><br>
                        ‚Ä¢ <strong>–ë–∞–ª–∞–Ω—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è –£–í–ï–õ–ò–ß–ò–í–ê–ï–¢–°–Ø</strong><br>
                        ‚Ä¢ Total Supply (mint address) <strong>–ù–ï –º–µ–Ω—è–µ—Ç—Å—è</strong> - —ç—Ç–æ transfer, –Ω–µ mint
                    </p>
                </div>
                <div style="margin-bottom: 15px;">
                    <label><strong>Amount (TAMA):</strong></label>
                    <input type="number" id="sendAmount" placeholder="Enter amount" min="1" step="1" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; margin-top: 5px;">
                </div>
                <div id="sendResult" style="margin-top: 15px;"></div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button onclick="executeSend()" class="btn-success" style="flex: 1; background: #9c27b0;">üí∏ Send Tokens</button>
                    <button onclick="closeSendModal()" style="background: #6c757d; flex: 1;">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for viewing logs -->
    <div class="modal" id="logsModal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeLogsModal()">&times;</span>
            <h2>üìã Access Logs</h2>
            <div style="margin-bottom: 15px;">
                <button onclick="clearLogs()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                    üóëÔ∏è Clear Logs
                </button>
                <button onclick="exportLogs()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                    üíæ Export Logs
                </button>
            </div>
            <div id="logsContent" style="max-height: 500px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.85em; background: #f8f9fa; padding: 15px; border-radius: 5px;">
                <!-- Logs will be displayed here -->
            </div>
        </div>
    </div>
    
    <!-- Modal for token distribution -->
    <div class="modal" id="distributeModal">
        <div class="modal-content">
            <span class="close" onclick="closeDistributeModal()">&times;</span>
            <h2>üì§ Distribute Tokens</h2>
            <div id="distributeContent">
                <div style="margin-bottom: 15px;">
                    <label><strong>From Wallet:</strong></label>
                    <div style="font-family: 'Courier New', monospace; background: #f8f9fa; padding: 8px; border-radius: 5px; margin-top: 5px;" id="distributeFromWallet"></div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label><strong>To Wallet:</strong></label>
                    <select id="distributeToWallet" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; margin-top: 5px;">
                        <option value="">Select recipient wallet...</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label><strong>Amount (TAMA):</strong></label>
                    <input type="number" id="distributeAmount" placeholder="Enter amount" min="1" step="1" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; margin-top: 5px;">
                </div>
                <div id="distributeResult" style="margin-top: 15px;"></div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button onclick="executeDistribute()" class="btn-success" style="flex: 1;">üöÄ Send Tokens</button>
                    <button onclick="closeDistributeModal()" style="background: #6c757d; flex: 1;">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Wallet configuration
        const wallets = [
            {
                name: 'P2E Pool',
                address: 'HPQf1MG8e41MoMayD8iqFmadqZ2NteScx4dQuwc1fCQw',
                allocation: 400000000,
                percentage: 40,
                status: 'active',
                keypairFile: 'p2e-pool-keypair.json',
                description: 'Play-to-Earn rewards pool'
            },
            {
                name: 'Team',
                address: 'AQr5BM4FUKumKwdcNMWM1FPVx6qLWssp55HqH4SkWXVR',
                allocation: 200000000,
                percentage: 20,
                status: 'locked',
                keypairFile: 'team-wallet-keypair.json',
                description: 'Team allocation (vesting 4 years)'
            },
            {
                name: 'Marketing',
                address: '2eryce7DH7mqDCPegTb696FjXReA5qmx9xfCKH5UneeF',
                allocation: 150000000,
                percentage: 15,
                status: 'active',
                keypairFile: 'marketing-wallet-keypair.json',
                description: 'Marketing & partnerships'
            },
            {
                name: 'Liquidity',
                address: '5kHACukYuErqSzURPTtexS7CXdqv9eJ9eNvydDz3o36z',
                allocation: 100000000,
                percentage: 10,
                status: 'locked',
                keypairFile: 'liquidity-pool-keypair.json',
                description: 'DEX liquidity (Raydium, Jupiter)'
            },
            {
                name: 'Community',
                address: '9X1DYKzHiYP4V2UuVNGbU42DQkd8ST1nPwbJDuFQY3T',
                allocation: 100000000,
                percentage: 10,
                status: 'active',
                keypairFile: 'community-wallet-keypair.json',
                description: 'Community rewards & airdrops'
            },
            {
                name: 'Reserve',
                address: '8cDHbeHcuspjGKXofYzApCCBrAVenSHPy2UAPU1iCEj6',
                allocation: 50000000,
                percentage: 5,
                status: 'locked',
                keypairFile: 'reserve-wallet-keypair.json',
                description: 'Reserve fund (emergency)'
            },
            {
                name: 'üí∞ Treasury Main V2',
                address: '6rY5inYo8JmDTj91UwMKLr1MyxyAAQGjLpJhSi6dNpFM',
                allocation: 0,
                percentage: 0,
                status: 'active',
                keypairFile: 'treasury-main-v2-keypair.json',
                description: 'üíé NFT Sales Revenue (TAMA Bronze: 30% | SOL Silver/Gold: 50%)'
            },
            {
                name: 'üíß Treasury Liquidity V2',
                address: 'CeeKjLEVfY15fmiVnPrGzjneN5i3UsrRW4r4XHdavGk1',
                allocation: 0,
                percentage: 0,
                status: 'active',
                keypairFile: 'treasury-liquidity-v2-keypair.json',
                description: 'üåä DEX Liquidity Pool (SOL Silver/Gold: 30%)'
            },
            {
                name: 'üë• Treasury Team V2',
                address: 'Amy5EJqZWp713SaT3nieXSSZjxptVXJA1LhtpTE7Ua8',
                allocation: 0,
                percentage: 0,
                status: 'active',
                keypairFile: 'treasury-team-v2-keypair.json',
                description: 'üíº Team Operations (SOL Silver/Gold: 20%)'
            },
            {
                name: 'Payer',
                address: '8s88JVHG8Cb6HGKi25rjnMA19MuW723M6pJRDW3maDVi',
                allocation: 0,
                percentage: 0,
                status: 'active',
                keypairFile: 'payer-keypair.json',
                description: 'Transaction payer & mint authority'
            },
            {
                name: 'Mint Authority',
                address: 'Fuqw8Zg17XhHGXfghLYD1fqjxJa1PnmG2MmoqG5pcmLY',
                allocation: 0,
                percentage: 0,
                status: 'active',
                keypairFile: 'tama-mint-keypair.json',
                description: 'Token mint authority (can create new tokens)'
            }
        ];
        
        // Store loaded keypairs in memory (not sent to server)
        const loadedKeypairs = {};
        
        // Render wallets
        function renderWallets() {
            const grid = document.getElementById('walletGrid');
            grid.innerHTML = '';
            
            wallets.forEach(wallet => {
                const card = document.createElement('div');
                card.className = 'wallet-card';
                card.innerHTML = `
                    <h3>${wallet.name} ${wallet.status === 'locked' ? 'üîí' : '‚úÖ'}</h3>
                    ${wallet.status === 'locked' ? 
                        '<div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 5px; padding: 8px; margin-bottom: 10px; color: #856404; font-size: 0.85em;"><strong>üîí LOCKED:</strong> –£—Å–ª–æ–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è)</div>' : 
                        ''
                    }
                    <div class="wallet-info">
                        <label>Address:</label>
                        <div class="value address" onclick="copyToClipboard('${wallet.address}')">
                            ${wallet.address}
                        </div>
                    </div>
                    <div class="wallet-info">
                        <label>Allocation:</label>
                        <div class="value">${formatNumber(wallet.allocation)} TAMA (${wallet.percentage}%)</div>
                    </div>
                    <div class="wallet-info">
                        <label>Status:</label>
                        <span class="status ${wallet.status}">${wallet.status.toUpperCase()}</span>
                    </div>
                    <div class="wallet-info">
                        <label>Description:</label>
                        <div class="value" style="font-size: 0.85em;">${wallet.description}</div>
                    </div>
                    <div class="wallet-info" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <label style="font-size: 0.85em; color: #666;">Keypair File:</label>
                        <div class="value" style="font-size: 0.85em; color: #667eea;">
                            <code>${wallet.keypairFile}</code>
                            <br><small style="color: #999;">Path: C:\\goooog\\${wallet.keypairFile}</small>
                        </div>
                    </div>
                    <div class="actions">
                        <button onclick="loadKeypairForWallet('${wallet.keypairFile}', '${wallet.name}')">
                            üìÅ Load Keypair
                        </button>
                        <button onclick="checkBalance('${wallet.address}', '${wallet.name}')" 
                                ${wallet.address === 'N/A' ? 'disabled' : ''}>
                            üí∞ Check Balance
                        </button>
                        <button onclick="openDistributeModal('${wallet.address}', '${wallet.name}')" 
                                ${wallet.address === 'N/A' ? 'disabled' : ''}
                                class="btn-success">
                            üì§ Distribute
                        </button>
                        <button onclick="openMintModal('${wallet.address}', '${wallet.name}')" 
                                ${wallet.name !== 'Mint Authority' ? 'disabled' : ''}
                                class="btn-success"
                                style="background: #ff9800;">
                            ü™ô Mint Tokens
                        </button>
                        <button onclick="openSendModal('${wallet.address}', '${wallet.name}', '${wallet.keypairFile}')" 
                                ${wallet.address === 'N/A' || wallet.name === 'Mint Authority' ? 'disabled' : ''}
                                class="btn-success"
                                style="background: #9c27b0;">
                            üí∏ Send Tokens
                        </button>
                        <button onclick="viewOnExplorer('${wallet.address}')" 
                                ${wallet.address === 'N/A' ? 'disabled' : ''}
                                class="btn-success">
                            üîó Explorer
                        </button>
                    </div>
                    ${loadedKeypairs[wallet.keypairFile] ? 
                        '<div style="margin-top: 10px; color: #28a745; font-weight: bold;">‚úÖ Keypair loaded (for balance check only)</div>' : 
                        '<div style="margin-top: 10px; color: #999; font-size: 0.9em;">‚ÑπÔ∏è For distribution: API uses payer-keypair.json automatically</div>'
                    }
                `;
                grid.appendChild(card);
            });
            
            updateStats();
        }
        
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toLocaleString();
        }
        
        // TAMA Token Info
        const TAMA_MINT_ADDRESS = 'Fuqw8Zg17XhHGXfghLYD1fqjxJa1PnmG2MmoqG5pcmLY';
        const SOLANA_RPC = 'https://api.devnet.solana.com';
        let realTotalSupply = 1000000000; // Default, will be updated from blockchain
        
        // Get real token supply from blockchain
        async function fetchRealTokenSupply() {
            try {
                const response = await fetch(SOLANA_RPC, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getTokenSupply',
                        params: [TAMA_MINT_ADDRESS]
                    })
                });
                
                const data = await response.json();
                
                if (data.result && data.result.value) {
                    // Supply is in smallest unit (with decimals), divide by 10^9
                    realTotalSupply = parseInt(data.result.value.amount) / Math.pow(10, 9);
                    console.log('‚úÖ Real token supply from blockchain:', realTotalSupply);
                    return realTotalSupply;
                } else {
                    console.warn('‚ö†Ô∏è Could not fetch supply, using default');
                    return 1000000000;
                }
            } catch (error) {
                console.error('‚ùå Error fetching token supply:', error);
                return 1000000000; // Fallback to default
            }
        }
        
        // Get total burned tokens from Supabase
        async function fetchBurnedTokens() {
            try {
                const SUPABASE_URL = 'https://zfrazyupameidxpjihrh.supabase.co';
                const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmcmF6eXVwYW1laWR4cGppaHJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY0NDgyMjgsImV4cCI6MjA2MjAyNDIyOH0.w5k-Z40rD7Qw7zAC9JaEePzgEy2n8h-MvuiuUx7hW-4';
                
                const response = await fetch(`${SUPABASE_URL}/rest/v1/transactions?select=amount&type=eq.burn_from_bronze_nft_onchain`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    console.warn('‚ö†Ô∏è Could not fetch burn transactions');
                    return 0;
                }
                
                const burnTransactions = await response.json();
                const totalBurned = burnTransactions.reduce((sum, tx) => sum + (tx.amount || 0), 0);
                
                console.log(`‚úÖ Total burned from database: ${totalBurned} TAMA (${burnTransactions.length} transactions)`);
                return totalBurned;
            } catch (error) {
                console.error('‚ùå Error fetching burned tokens:', error);
                return 0;
            }
        }
        
        async function updateStats() {
            // Fetch real supply from blockchain
            await fetchRealTokenSupply();
            
            // Fetch burned tokens from database
            const totalBurned = await fetchBurnedTokens();
            
            // Calculate circulating supply (Total - Burned)
            const circulatingSupply = realTotalSupply - totalBurned;
            
            const totalDistributed = wallets.reduce((sum, w) => sum + w.allocation, 0);
            const remaining = realTotalSupply - totalDistributed;
            
            // Update UI
            document.getElementById('totalSupply').textContent = formatNumber(realTotalSupply);
            document.getElementById('totalBurned').textContent = formatNumber(totalBurned);
            document.getElementById('circulatingSupply').textContent = formatNumber(circulatingSupply);
            document.getElementById('totalDistributed').textContent = formatNumber(totalDistributed);
            document.getElementById('totalRemaining').textContent = formatNumber(remaining);
            
            // Add indicator if supply is different from initial
            const supplyElement = document.getElementById('totalSupply');
            if (realTotalSupply !== 1000000000) {
                supplyElement.style.color = '#28a745';
                supplyElement.title = `Real supply from blockchain (Initial: 1,000M)`;
            } else {
                supplyElement.style.color = '#667eea';
                supplyElement.title = 'Real supply from blockchain';
            }
            
            // Highlight circulating supply if different from total
            const circulatingElement = document.getElementById('circulatingSupply');
            if (totalBurned > 0) {
                circulatingElement.style.color = '#10b981';
                circulatingElement.title = `${formatNumber(totalBurned)} TAMA burned (${((totalBurned / realTotalSupply) * 100).toFixed(2)}% of total)`;
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Address copied to clipboard!');
            });
        }
        
        function viewOnExplorer(address) {
            const cluster = 'devnet'; // Change to 'mainnet-beta' for mainnet
            window.open(`https://explorer.solana.com/address/${address}?cluster=${cluster}`, '_blank');
        }
        
        let currentWallet = null;
        
        function loadKeypairForWallet(keypairFile, walletName) {
            currentWallet = { keypairFile, walletName };
            document.getElementById('keypairFileName').textContent = keypairFile;
            document.getElementById('keypairModal').classList.add('active');
        }
        
        function loadKeypair() {
            const fileInput = document.getElementById('keypairFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a keypair file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const keypair = JSON.parse(e.target.result);
                    
                    // Store in memory (NOT sent to server)
                    if (currentWallet) {
                        loadedKeypairs[currentWallet.keypairFile] = keypair;
                        alert(`‚úÖ Keypair loaded for ${currentWallet.walletName}\n\n‚ö†Ô∏è Keypair is stored in browser memory only (not sent to server)`);
                        closeModal();
                        renderWallets();
                    }
                } catch (error) {
                    alert('Error parsing keypair file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        function closeModal() {
            document.getElementById('keypairModal').classList.remove('active');
            document.getElementById('keypairFile').value = '';
            currentWallet = null;
        }
        
        async function checkBalance(address, walletName) {
            const modal = document.getElementById('balanceModal');
            const result = document.getElementById('balanceResult');
            
            result.innerHTML = '<p>Loading balance...</p>';
            modal.classList.add('active');
            
            try {
                // Check SOL balance
                const solResponse = await fetch(`https://api.devnet.solana.com`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getBalance',
                        params: [address]
                    })
                });
                
                const solData = await solResponse.json();
                const solBalance = (solData.result?.value || 0) / 1e9;
                
                // Check TAMA balance (if token account exists)
                const TAMA_MINT = 'Fuqw8Zg17XhHGXfghLYD1fqjxJa1PnmG2MmoqG5pcmLY';
                const tokenResponse = await fetch(`https://api.devnet.solana.com`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getTokenAccountsByOwner',
                        params: [
                            address,
                            { mint: TAMA_MINT },
                            { encoding: 'jsonParsed' }
                        ]
                    })
                });
                
                const tokenData = await tokenResponse.json();
                let tamaBalance = 0;
                
                if (tokenData.result?.value?.length > 0) {
                    const tokenAccount = tokenData.result.value[0].account.data.parsed.info.tokenAmount;
                    tamaBalance = parseFloat(tokenAccount.uiAmount || 0);
                }
                
                result.innerHTML = `
                    <h3>${walletName} Balance</h3>
                    <div style="margin-top: 20px;">
                        <div style="margin-bottom: 15px;">
                            <strong>SOL Balance:</strong>
                            <div style="font-size: 1.2em; color: #667eea; margin-top: 5px;">
                                ${solBalance.toFixed(4)} SOL
                            </div>
                        </div>
                        <div>
                            <strong>TAMA Balance:</strong>
                            <div style="font-size: 1.2em; color: #667eea; margin-top: 5px;">
                                ${formatNumber(tamaBalance)} TAMA
                            </div>
                        </div>
                    </div>
                    <button onclick="closeBalanceModal()" style="margin-top: 20px;">Close</button>
                `;
            } catch (error) {
                result.innerHTML = `
                    <p style="color: #dc3545;">Error checking balance: ${error.message}</p>
                    <button onclick="closeBalanceModal()" style="margin-top: 20px;">Close</button>
                `;
            }
        }
        
        function closeBalanceModal() {
            document.getElementById('balanceModal').classList.remove('active');
        }
        
        let currentDistributeFrom = null;
        let currentMintFrom = null;
        let currentSendFrom = null;
        
        function openMintModal(fromAddress, fromName) {
            currentMintFrom = { address: fromAddress, name: fromName };
            
            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (–≤—Å–µ –∫–æ—à–µ–ª—å–∫–∏)
            const toSelect = document.getElementById('mintToWallet');
            toSelect.innerHTML = '<option value="">Select recipient wallet...</option>';
            
            wallets.forEach(wallet => {
                if (wallet.address !== 'N/A' && wallet.name !== 'Mint Authority') {
                    const option = document.createElement('option');
                    option.value = wallet.address;
                    option.textContent = `${wallet.name} (${wallet.address.substring(0, 8)}...)`;
                    toSelect.appendChild(option);
                }
            });
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
            document.getElementById('mintAmount').value = '';
            document.getElementById('mintResult').innerHTML = '';
            
            document.getElementById('mintModal').classList.add('active');
        }
        
        function closeMintModal() {
            document.getElementById('mintModal').classList.remove('active');
            currentMintFrom = null;
        }
        
        async function executeMint() {
            if (!requireAuth()) return;
            logAccess('mint_attempt', {});
            
            const toWallet = document.getElementById('mintToWallet').value;
            const amount = document.getElementById('mintAmount').value;
            const resultDiv = document.getElementById('mintResult');
            
            if (!toWallet) {
                resultDiv.innerHTML = '<p style="color: #dc3545;">Please select a recipient wallet</p>';
                return;
            }
            
            if (!amount || parseFloat(amount) < 1) {
                resultDiv.innerHTML = '<p style="color: #dc3545;">Please enter a valid amount (minimum 1 TAMA)</p>';
                return;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
            resultDiv.innerHTML = '<p style="color: #667eea;">‚è≥ Minting tokens...</p>';
            
            try {
                const API_BASE = 'https://huma-chain-xyz.onrender.com/api/tama';
                const response = await fetch(`${API_BASE}/mint`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        to_wallet: toWallet,
                        amount: parseFloat(amount)
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Mint failed');
                }
                
                if (data.success) {
                    const toWalletName = wallets.find(w => w.address === toWallet)?.name || 'Unknown';
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 8px; padding: 15px; color: #155724;">
                            <h3 style="margin-top: 0; color: #155724;">‚úÖ Tokens Minted!</h3>
                            <p><strong>Mint Address:</strong> Fuqw8Zg17XhHGXfghLYD1fqjxJa1PnmG2MmoqG5pcmLY</p>
                            <p><strong>To:</strong> ${toWalletName}</p>
                            <p><strong>Amount:</strong> ${parseFloat(amount).toLocaleString()} TAMA</p>
                            <p><strong>Signature:</strong> <code style="font-size: 0.9em;">${data.signature}</code></p>
                            <a href="${data.explorer_url}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: bold;">
                                üîó View on Explorer ‚Üí
                            </a>
                        </div>
                    `;
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        const toWalletName = wallets.find(w => w.address === toWallet)?.name;
                        if (toWalletName) {
                            checkBalance(toWallet, toWalletName);
                        }
                    }, 2000);
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; border: 2px solid #dc3545; border-radius: 8px; padding: 15px; color: #721c24;">
                        <h3 style="margin-top: 0; color: #721c24;">‚ùå Error</h3>
                        <p>${error.message}</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">Make sure the API server is accessible at huma-chain-xyz.onrender.com</p>
                    </div>
                `;
            }
        }
        
        function openSendModal(fromAddress, fromName, keypairFile) {
            if (!requireAuth()) return;
            logAccess('open_send_modal', { wallet: fromName });
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ—à–µ–ª—å–∫–∞
            const wallet = wallets.find(w => w.address === fromAddress);
            const isLocked = wallet && wallet.status === 'locked';
            
            if (isLocked) {
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
                const confirmed = confirm(
                    `‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! ‚ö†Ô∏è\n\n` +
                    `–ö–æ—à–µ–ª–µ–∫ "${fromName}" –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ù–´–ô (üîí LOCKED)!\n\n` +
                    `–¢–µ–∫—É—â–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –£–°–õ–û–í–ù–ê–Ø (–Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è).\n` +
                    `–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ç—ã –ú–û–ñ–ï–®–¨ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã, –ù–û:\n\n` +
                    `‚ùå –≠—Ç–æ –Ω–∞—Ä—É—à–∏—Ç —Ç–æ–∫–µ–Ω–æ–º–∏–∫—É –ø—Ä–æ–µ–∫—Ç–∞\n` +
                    `‚ùå –ü–æ—Ç–µ—Ä—è –¥–æ–≤–µ—Ä–∏—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞\n` +
                    `‚ùå –†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏\n\n` +
                    `–î–ª—è mainnet –Ω—É–∂–Ω–∞ –†–ï–ê–õ–¨–ù–ê–Ø –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (Streamflow/Multi-sig).\n\n` +
                    `–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É?`
                );
                
                if (!confirmed) {
                    return; // –û—Ç–º–µ–Ω–∞
                }
            }
            
            currentSendFrom = { address: fromAddress, name: fromName, keypairFile: keypairFile };
            document.getElementById('sendFromWallet').textContent = `${fromName}: ${fromAddress}`;
            
            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (–≤—Å–µ –∫–æ—à–µ–ª—å–∫–∏ –∫—Ä–æ–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è)
            const toSelect = document.getElementById('sendToWalletSelect');
            toSelect.innerHTML = '<option value="">Or select from project wallets...</option>';
            
            wallets.forEach(wallet => {
                if (wallet.address !== fromAddress && wallet.address !== 'N/A') {
                    const option = document.createElement('option');
                    option.value = wallet.address;
                    option.textContent = `${wallet.name} (${wallet.address.substring(0, 8)}...)`;
                    toSelect.appendChild(option);
                }
            });
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
            document.getElementById('sendToWallet').value = '';
            document.getElementById('sendAmount').value = '';
            document.getElementById('sendResult').innerHTML = '';
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –¥–ª—è locked wallets
            const sendContent = document.getElementById('sendContent');
            // –£–±—Ä–∞—Ç—å —Å—Ç–∞—Ä–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
            const existingWarning = document.getElementById('sendLockedWarning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            if (isLocked) {
                const warningDiv = document.createElement('div');
                warningDiv.id = 'sendLockedWarning';
                warningDiv.style.cssText = 'margin-bottom: 15px; padding: 15px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; color: #856404;';
                warningDiv.innerHTML = `
                    <strong>üîí –í–ù–ò–ú–ê–ù–ò–ï: –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ù–´–ô –ö–û–®–ï–õ–ï–ö!</strong><br>
                    <small style="display: block; margin-top: 8px;">
                    ‚Ä¢ –¢–µ–∫—É—â–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –£–°–õ–û–í–ù–ê–Ø (–Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è)<br>
                    ‚Ä¢ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ú–û–ñ–ï–®–¨ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å, –ù–û —ç—Ç–æ –Ω–∞—Ä—É—à–∏—Ç —Ç–æ–∫–µ–Ω–æ–º–∏–∫—É<br>
                    ‚Ä¢ –î–ª—è mainnet –Ω—É–∂–Ω–∞ –†–ï–ê–õ–¨–ù–ê–Ø –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (Streamflow/Multi-sig)<br>
                    ‚Ä¢ <strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω—ã —Å —ç—Ç–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞!</strong>
                    </small>
                `;
                // –í—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–æ sendContent
                const firstChild = sendContent.firstElementChild;
                if (firstChild) {
                    sendContent.insertBefore(warningDiv, firstChild);
                } else {
                    sendContent.appendChild(warningDiv);
                }
            }
            
            document.getElementById('sendModal').classList.add('active');
        }
        
        function closeSendModal() {
            document.getElementById('sendModal').classList.remove('active');
            currentSendFrom = null;
        }
        
        async function executeSend() {
            if (!requireAuth()) return;
            logAccess('send_attempt', {});
            
            const toWallet = document.getElementById('sendToWallet').value.trim();
            const amount = document.getElementById('sendAmount').value;
            const resultDiv = document.getElementById('sendResult');
            
            if (!currentSendFrom) {
                resultDiv.innerHTML = '<p style="color: #dc3545;">Error: No source wallet selected</p>';
                return;
            }
            
            if (!toWallet) {
                resultDiv.innerHTML = '<p style="color: #dc3545;">Please enter or select a recipient wallet address</p>';
                return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ Solana (–±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
            if (toWallet.length < 32 || toWallet.length > 44) {
                resultDiv.innerHTML = '<p style="color: #dc3545;">Invalid Solana wallet address</p>';
                return;
            }
            
            if (!amount || parseFloat(amount) < 1) {
                resultDiv.innerHTML = '<p style="color: #dc3545;">Please enter a valid amount (minimum 1 TAMA)</p>';
                return;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
            resultDiv.innerHTML = '<p style="color: #667eea;">‚è≥ Sending tokens...</p>';
            
            try {
                const API_BASE = 'https://huma-chain-xyz.onrender.com/api/tama';
                const response = await fetch(`${API_BASE}/send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        from_wallet: currentSendFrom.address,
                        from_keypair_file: currentSendFrom.keypairFile,
                        to_wallet: toWallet,
                        amount: parseFloat(amount)
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏
                    const error = new Error(data.error || 'Send failed');
                    error.response = response;
                    error.data = data;
                    throw error;
                }
                
                if (data.success) {
                    const toWalletName = wallets.find(w => w.address === toWallet)?.name || toWallet.substring(0, 8) + '...';
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 8px; padding: 15px; color: #155724;">
                            <h3 style="margin-top: 0; color: #155724;">‚úÖ Tokens Sent!</h3>
                            <p><strong>From:</strong> ${currentSendFrom.name}</p>
                            <p><strong>To:</strong> ${toWalletName}</p>
                            <p><strong>Amount:</strong> ${parseFloat(amount).toLocaleString()} TAMA</p>
                            <p><strong>Signature:</strong> <code style="font-size: 0.9em;">${data.signature}</code></p>
                            <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; color: #856404; font-size: 0.9em;">
                                <strong>‚ÑπÔ∏è –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:</strong><br>
                                ‚Ä¢ –ë–∞–ª–∞–Ω—Å <strong>${currentSendFrom.name}</strong> —É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ ${parseFloat(amount).toLocaleString()} TAMA<br>
                                ‚Ä¢ –ë–∞–ª–∞–Ω—Å <strong>${toWalletName}</strong> —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ ${parseFloat(amount).toLocaleString()} TAMA<br>
                                ‚Ä¢ <strong>Total Supply –ù–ï –∏–∑–º–µ–Ω–∏–ª—Å—è</strong> (—Ç–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã, –Ω–µ —Å–æ–∑–¥–∞–Ω—ã)
                            </div>
                            <a href="${data.explorer_url}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: bold; display: inline-block; margin-top: 10px;">
                                üîó View on Explorer ‚Üí
                            </a>
                        </div>
                    `;
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        checkBalance(currentSendFrom.address, currentSendFrom.name);
                        const toWalletName = wallets.find(w => w.address === toWallet)?.name;
                        if (toWalletName) {
                            checkBalance(toWallet, toWalletName);
                        }
                    }, 2000);
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (error) {
                let errorDetails = error.message;
                
                // –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏–∑–≤–ª–µ—á—å –¥–µ—Ç–∞–ª–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ API
                if (error.data) {
                    const errorData = error.data;
                    if (errorData.error) {
                        errorDetails = errorData.error;
                    }
                    if (errorData.details) {
                        errorDetails += '<br><strong>Details:</strong> ' + errorData.details;
                    }
                    if (errorData.stderr) {
                        errorDetails += '<br><strong>Error Details:</strong> <code style="font-size: 0.85em;">' + errorData.stderr + '</code>';
                    }
                    if (errorData.path) {
                        errorDetails += '<br><strong>Path:</strong> ' + errorData.path;
                    }
                    if (errorData.from_keypair_path) {
                        errorDetails += '<br><strong>Keypair Path:</strong> <code>' + errorData.from_keypair_path + '</code>';
                    }
                }
                
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; border: 2px solid #dc3545; border-radius: 8px; padding: 15px; color: #721c24;">
                        <h3 style="margin-top: 0; color: #721c24;">‚ùå Error</h3>
                        <p>${errorDetails}</p>
                        <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px; color: #856404;">
                            <strong>üîç Troubleshooting:</strong>
                            <ul style="margin: 10px 0 0 20px;">
                                <li>–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: <code>https://huma-chain-xyz.onrender.com/api/tama/test</code></li>
                                <li>–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ keypair —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: <code>${currentSendFrom.keypairFile}</code></li>
                                <li>–ü—Ä–æ–≤–µ—Ä—å –±–∞–ª–∞–Ω—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π TAMA)</li>
                                <li>–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ payer-keypair.json –∏–º–µ–µ—Ç SOL –¥–ª—è –∫–æ–º–∏—Å—Å–∏–π</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }
        
        function openDistributeModal(fromAddress, fromName) {
            currentDistributeFrom = { address: fromAddress, name: fromName };
            document.getElementById('distributeFromWallet').textContent = `${fromName}: ${fromAddress}`;
            
            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (–≤—Å–µ –∫–æ—à–µ–ª—å–∫–∏ –∫—Ä–æ–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è)
            const toSelect = document.getElementById('distributeToWallet');
            toSelect.innerHTML = '<option value="">Select recipient wallet...</option>';
            
            wallets.forEach(wallet => {
                if (wallet.address !== fromAddress && wallet.address !== 'N/A') {
                    const option = document.createElement('option');
                    option.value = wallet.address;
                    option.textContent = `${wallet.name} (${wallet.address.substring(0, 8)}...)`;
                    toSelect.appendChild(option);
                }
            });
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
            document.getElementById('distributeAmount').value = '';
            document.getElementById('distributeResult').innerHTML = '';
            
            document.getElementById('distributeModal').classList.add('active');
        }
        
        function closeDistributeModal() {
            document.getElementById('distributeModal').classList.remove('active');
            currentDistributeFrom = null;
        }
        
        async function executeDistribute() {
            if (!requireAuth()) return;
            logAccess('distribute_attempt', {});
            
            const toWallet = document.getElementById('distributeToWallet').value;
            const amount = document.getElementById('distributeAmount').value;
            const resultDiv = document.getElementById('distributeResult');
            
            if (!currentDistributeFrom) {
                resultDiv.innerHTML = '<p style="color: #dc3545;">Error: No source wallet selected</p>';
                return;
            }
            
            if (!toWallet) {
                resultDiv.innerHTML = '<p style="color: #dc3545;">Please select a recipient wallet</p>';
                return;
            }
            
            if (!amount || parseFloat(amount) < 1) {
                resultDiv.innerHTML = '<p style="color: #dc3545;">Please enter a valid amount (minimum 1 TAMA)</p>';
                return;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
            resultDiv.innerHTML = '<p style="color: #667eea;">‚è≥ Sending transaction...</p>';
            
            try {
                const API_BASE = 'https://huma-chain-xyz.onrender.com/api/tama';
                const response = await fetch(`${API_BASE}/distribute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        from_wallet: currentDistributeFrom.address,
                        to_wallet: toWallet,
                        amount: parseFloat(amount)
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Transaction failed');
                }
                
                if (data.success) {
                    const toWalletName = wallets.find(w => w.address === toWallet)?.name || 'Unknown';
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 8px; padding: 15px; color: #155724;">
                            <h3 style="margin-top: 0; color: #155724;">‚úÖ Success!</h3>
                            <p><strong>From:</strong> ${currentDistributeFrom.name}</p>
                            <p><strong>To:</strong> ${toWalletName}</p>
                            <p><strong>Amount:</strong> ${parseFloat(amount).toLocaleString()} TAMA</p>
                            <p><strong>Signature:</strong> <code style="font-size: 0.9em;">${data.signature}</code></p>
                            <a href="${data.explorer_url}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: bold;">
                                üîó View on Explorer ‚Üí
                            </a>
                        </div>
                    `;
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        checkBalance(currentDistributeFrom.address, currentDistributeFrom.name);
                        const toWalletName = wallets.find(w => w.address === toWallet)?.name;
                        if (toWalletName) {
                            checkBalance(toWallet, toWalletName);
                        }
                    }, 2000);
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; border: 2px solid #dc3545; border-radius: 8px; padding: 15px; color: #721c24;">
                        <h3 style="margin-top: 0; color: #721c24;">‚ùå Error</h3>
                        <p>${error.message}</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">Make sure the API server is accessible at huma-chain-xyz.onrender.com</p>
                    </div>
                `;
            }
        }
        
        // Initialize
        renderWallets();
        // Load real supply immediately
        updateStats();
        
        // Wrap critical functions after they're defined
        const originalOpenMintModal = openMintModal;
        openMintModal = function(...args) {
            if (!requireAuth()) return;
            return originalOpenMintModal.apply(this, args);
        };
        
        const originalOpenSendModal = openSendModal;
        openSendModal = function(...args) {
            if (!requireAuth()) return;
            return originalOpenSendModal.apply(this, args);
        };
        
        const originalOpenDistributeModal = openDistributeModal;
        openDistributeModal = function(...args) {
            if (!requireAuth()) return;
            return originalOpenDistributeModal.apply(this, args);
        };
        
        // Close modals on outside click
        window.onclick = (event) => {
            const keypairModal = document.getElementById('keypairModal');
            const balanceModal = document.getElementById('balanceModal');
            const distributeModal = document.getElementById('distributeModal');
            const mintModal = document.getElementById('mintModal');
            const sendModal = document.getElementById('sendModal');
            const logsModal = document.getElementById('logsModal');
            if (event.target === keypairModal) {
                closeModal();
            }
            if (event.target === balanceModal) {
                closeBalanceModal();
            }
            if (event.target === distributeModal) {
                closeDistributeModal();
            }
            if (event.target === mintModal) {
                closeMintModal();
            }
            if (event.target === sendModal) {
                closeSendModal();
            }
            if (event.target === logsModal) {
                closeLogsModal();
            }
        };
        
        // ============================================
        // SECURITY: PASSWORD PROTECTION
        // ============================================
        
        // Check if password.js is loaded
        if (typeof ADMIN_PASSWORD === 'undefined') {
            document.getElementById('loginError').textContent = 'Error: password.js not found! Please create wallet-admin-password.js';
            document.getElementById('passwordInput').disabled = true;
        }
        
        // Check authentication on page load
        function checkSession() {
            const auth = sessionStorage.getItem('admin_authenticated');
            const timestamp = sessionStorage.getItem('auth_timestamp');
            
            if (auth === 'true' && timestamp) {
                const elapsed = Date.now() - parseInt(timestamp);
                if (elapsed < SESSION_TIMEOUT) {
                    // Session valid, show main content
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    logAccess('session_resumed', { elapsed: Math.round(elapsed / 1000) + 's' });
                    return true;
                } else {
                    // Session expired
                    sessionStorage.removeItem('admin_authenticated');
                    sessionStorage.removeItem('auth_timestamp');
                    logAccess('session_expired', {});
                }
            }
            return false;
        }
        
        // Check password
        function checkPassword() {
            const input = document.getElementById('passwordInput');
            const password = input.value;
            const errorDiv = document.getElementById('loginError');
            
            if (!password) {
                errorDiv.textContent = 'Please enter password';
                return;
            }
            
            let isValid = false;
            
            // Check password (with or without hash)
            if (ADMIN_PASSWORD_HASH && ADMIN_PASSWORD_HASH !== '') {
                // Use hash comparison
                const hash = sha256(password);
                isValid = hash === ADMIN_PASSWORD_HASH;
            } else {
                // Use direct comparison
                isValid = password === ADMIN_PASSWORD;
            }
            
            if (isValid) {
                // Success - set session
                sessionStorage.setItem('admin_authenticated', 'true');
                sessionStorage.setItem('auth_timestamp', Date.now().toString());
                
                // Hide login, show main content
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                
                // Clear password field
                input.value = '';
                
                // Log access
                logAccess('login_success', {});
            } else {
                // Failed - show error
                errorDiv.textContent = '‚ùå Invalid password!';
                input.value = '';
                input.focus();
                
                // Log failed attempt
                logAccess('login_failed', {});
                
                // Lock after 5 failed attempts
                const failedAttempts = parseInt(sessionStorage.getItem('failed_attempts') || '0') + 1;
                sessionStorage.setItem('failed_attempts', failedAttempts.toString());
                
                if (failedAttempts >= 5) {
                    errorDiv.textContent = '‚ùå Too many failed attempts! Page will reload in 30 seconds.';
                    input.disabled = true;
                    setTimeout(() => {
                        window.location.reload();
                    }, 30000);
                }
            }
        }
        
        // Allow Enter key to submit
        document.addEventListener('DOMContentLoaded', () => {
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        checkPassword();
                    }
                });
                passwordInput.focus();
            }
            
            // Check existing session
            if (!checkSession()) {
                // No valid session, show login
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainContent').classList.add('hidden');
            }
        });
        
        // ============================================
        // SECURITY: LOGGING
        // ============================================
        
        function logAccess(action, details) {
            const log = {
                timestamp: new Date().toISOString(),
                action: action,
                details: details,
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            // Save to localStorage (last 200 entries)
            try {
                const logs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
                logs.push(log);
                localStorage.setItem('admin_logs', JSON.stringify(logs.slice(-200)));
            } catch (e) {
                console.error('Error logging access:', e);
            }
            
            // Also log critical actions to console
            if (action.includes('mint') || action.includes('send') || action.includes('distribute')) {
                console.log('üîê ADMIN ACTION:', action, details);
            }
        }
        
        // Log all critical operations (wrapped after function definitions)
        // This will be called after functions are defined
        
        // Check session before critical operations
        function requireAuth() {
            if (!checkSession()) {
                alert('Session expired! Please login again.');
                window.location.reload();
                return false;
            }
            return true;
        }
        
        // Wrap critical functions (will be set after function definitions)
        
        // Auto-logout on inactivity (optional)
        let inactivityTimer;
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                if (checkSession()) {
                    alert('Session expired due to inactivity. Please login again.');
                    sessionStorage.clear();
                    window.location.reload();
                }
            }, SESSION_TIMEOUT);
        }
        
        // Reset timer on user activity
        ['mousedown', 'keydown', 'scroll', 'touchstart'].forEach(event => {
            document.addEventListener(event, resetInactivityTimer);
        });
        
        // View logs
        function viewLogs() {
            if (!requireAuth()) return;
            
            const logs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
            const logsContent = document.getElementById('logsContent');
            
            if (logs.length === 0) {
                logsContent.innerHTML = '<p>No logs yet.</p>';
            } else {
                let html = '<table style="width: 100%; border-collapse: collapse;">';
                html += '<tr style="background: #667eea; color: white;"><th style="padding: 8px; text-align: left;">Time</th><th style="padding: 8px; text-align: left;">Action</th><th style="padding: 8px; text-align: left;">Details</th></tr>';
                
                logs.reverse().forEach(log => {
                    const time = new Date(log.timestamp).toLocaleString();
                    const action = log.action;
                    const details = JSON.stringify(log.details || {});
                    const color = action.includes('failed') || action.includes('error') ? '#f8d7da' : 
                                  action.includes('success') ? '#d4edda' : '#fff';
                    
                    html += `<tr style="background: ${color};"><td style="padding: 8px; border: 1px solid #ddd;">${time}</td><td style="padding: 8px; border: 1px solid #ddd;">${action}</td><td style="padding: 8px; border: 1px solid #ddd;">${details}</td></tr>`;
                });
                
                html += '</table>';
                logsContent.innerHTML = html;
            }
            
            document.getElementById('logsModal').classList.add('active');
        }
        
        function closeLogsModal() {
            document.getElementById('logsModal').classList.remove('active');
        }
        
        function clearLogs() {
            if (confirm('Are you sure you want to clear all logs?')) {
                localStorage.removeItem('admin_logs');
                viewLogs();
            }
        }
        
        function exportLogs() {
            const logs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
            const dataStr = JSON.stringify(logs, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `admin-logs-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        // Initialize
        resetInactivityTimer();
    </script>
    </div> <!-- End mainContent -->
    
    <!-- Modal for Token Holders -->
    <div class="modal" id="holdersModal">
        <div class="modal-content" style="max-width: 90%; max-height: 90vh; overflow-y: auto;">
            <span class="close" onclick="closeHoldersModal()">&times;</span>
            <h2>üìä –í—Å–µ –¥–µ—Ä–∂–∞—Ç–µ–ª–∏ TAMA —Ç–æ–∫–µ–Ω–æ–≤</h2>
            <div id="holdersStats" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <p style="color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
            </div>
            <div id="holdersTableContainer" style="overflow-x: auto;">
                <table id="holdersTable" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: #667eea; color: white;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">#</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Token Account</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">–ë–∞–ª–∞–Ω—Å (TAMA)</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">% –æ—Ç Total</th>
                        </tr>
                    </thead>
                    <tbody id="holdersTableBody">
                        <tr>
                            <td colspan="5" style="padding: 20px; text-align: center; color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button onclick="closeHoldersModal()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
                <button onclick="loadTokenHolders()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
    
    <script>
        async function loadTokenHolders() {
            if (!requireAuth()) return;
            logAccess('view_holders', {});
            
            const modal = document.getElementById('holdersModal');
            const statsDiv = document.getElementById('holdersStats');
            const tableBody = document.getElementById('holdersTableBody');
            
            modal.classList.add('active');
            statsDiv.innerHTML = '<p style="color: #666;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>';
            tableBody.innerHTML = '<tr><td colspan="5" style="padding: 20px; text-align: center; color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';
            
            try {
                const API_BASE = 'https://huma-chain-xyz.onrender.com/api/tama';
                const response = await fetch(`${API_BASE}/holders`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to load holders');
                }
                
                if (data.success && data.holders) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    const totalHolders = data.total_holders || data.holders.length;
                    const totalBalance = data.total_balance || data.holders.reduce((sum, h) => sum + h.balance, 0);
                    
                    statsDiv.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #667eea;">${totalHolders}</div>
                                <div style="color: #666; font-size: 0.9em;">–í—Å–µ–≥–æ –¥–µ—Ä–∂–∞—Ç–µ–ª–µ–π</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #28a745;">${formatNumber(totalBalance)}</div>
                                <div style="color: #666; font-size: 0.9em;">–í—Å–µ–≥–æ TAMA</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #ffc107;">${data.mint_address.substring(0, 8)}...</div>
                                <div style="color: #666; font-size: 0.9em;">Mint Address</div>
                            </div>
                        </div>
                    `;
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                    tableBody.innerHTML = '';
                    data.holders.forEach((holder, index) => {
                        const percentage = totalBalance > 0 ? ((holder.balance / totalBalance) * 100).toFixed(4) : '0.0000';
                        const row = document.createElement('tr');
                        row.style.borderBottom = '1px solid #ddd';
                        row.innerHTML = `
                            <td style="padding: 10px; border: 1px solid #ddd;">${index + 1}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">
                                <a href="https://explorer.solana.com/address/${holder.address}?cluster=devnet" target="_blank" style="color: #667eea; text-decoration: none; font-family: 'Courier New', monospace;">
                                    ${holder.address.length > 44 ? holder.address.substring(0, 20) + '...' + holder.address.substring(holder.address.length - 8) : holder.address}
                                </a>
                            </td>
                            <td style="padding: 10px; border: 1px solid #ddd;">
                                <a href="https://explorer.solana.com/address/${holder.token_account}?cluster=devnet" target="_blank" style="color: #667eea; text-decoration: none; font-family: 'Courier New', monospace; font-size: 0.9em;">
                                    ${holder.token_account.substring(0, 8)}...
                                </a>
                            </td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: right; font-weight: bold;">
                                ${formatNumber(holder.balance)}
                            </td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: right; color: #666;">
                                ${percentage}%
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                statsDiv.innerHTML = `<p style="color: #dc3545;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
                tableBody.innerHTML = `<tr><td colspan="5" style="padding: 20px; text-align: center; color: #dc3545;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>`;
            }
        }
        
        function closeHoldersModal() {
            document.getElementById('holdersModal').classList.remove('active');
        }
        
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(2) + 'K';
            }
            return num.toFixed(2);
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const holdersModal = document.getElementById('holdersModal');
            const poolsModal = document.getElementById('poolsModal');
            if (event.target === holdersModal) {
                closeHoldersModal();
            }
            if (event.target === poolsModal) {
                closePoolsModal();
            }
        }
        
        async function loadPoolsDistribution() {
            if (!requireAuth()) return;
            logAccess('view_pools', {});
            
            const modal = document.getElementById('poolsModal');
            const statsDiv = document.getElementById('poolsStats');
            const tableBody = document.getElementById('poolsTableBody');
            
            modal.classList.add('active');
            statsDiv.innerHTML = '<p style="color: #666;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>';
            tableBody.innerHTML = '<tr><td colspan="8" style="padding: 20px; text-align: center; color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';
            
            try {
                const API_BASE = 'https://huma-chain-xyz.onrender.com/api/tama';
                const response = await fetch(`${API_BASE}/pools`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to load pools');
                }
                
                if (data.success && data.pools) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    const totalPlanned = data.total_planned || 1000000000;
                    const totalActual = data.total_actual || data.pools.reduce((sum, p) => sum + p.actual, 0);
                    const difference = totalActual - totalPlanned;
                    
                    statsDiv.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #667eea;">${formatNumber(totalPlanned)}</div>
                                <div style="color: #666; font-size: 0.9em;">–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: ${totalActual >= totalPlanned ? '#28a745' : '#ffc107'};">${formatNumber(totalActual)}</div>
                                <div style="color: #666; font-size: 0.9em;">–§–∞–∫—Ç–∏—á–µ—Å–∫–∏</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: ${difference >= 0 ? '#28a745' : '#dc3545'};">${difference >= 0 ? '+' : ''}${formatNumber(difference)}</div>
                                <div style="color: #666; font-size: 0.9em;">–†–∞–∑–Ω–∏—Ü–∞</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #ff6b35;">${data.pools.length}</div>
                                <div style="color: #666; font-size: 0.9em;">–ü—É–ª–ª–æ–≤</div>
                            </div>
                        </div>
                    `;
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                    tableBody.innerHTML = '';
                    data.pools.forEach((pool, index) => {
                        const diffColor = pool.difference >= 0 ? '#28a745' : '#dc3545';
                        const statusIcon = pool.status === 'active' ? '‚úÖ' : 'üîí';
                        const row = document.createElement('tr');
                        row.style.borderBottom = '1px solid #ddd';
                        row.innerHTML = `
                            <td style="padding: 10px; border: 1px solid #ddd;">${index + 1}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">
                                <strong>${pool.name}</strong><br>
                                <small style="color: #666;">${pool.description}</small>
                            </td>
                            <td style="padding: 10px; border: 1px solid #ddd;">
                                <a href="https://explorer.solana.com/address/${pool.address}?cluster=devnet" target="_blank" style="color: #667eea; text-decoration: none; font-family: 'Courier New', monospace; font-size: 0.85em;">
                                    ${pool.address.substring(0, 8)}...${pool.address.substring(pool.address.length - 8)}
                                </a>
                            </td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">
                                ${formatNumber(pool.planned)}
                            </td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: right; font-weight: bold;">
                                ${formatNumber(pool.actual)}
                            </td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: right; color: ${diffColor};">
                                ${pool.difference >= 0 ? '+' : ''}${formatNumber(pool.difference)}
                            </td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: right; color: #666;">
                                ${pool.percentage_planned.toFixed(2)}%
                            </td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
                                ${statusIcon} ${pool.status}
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                statsDiv.innerHTML = `<p style="color: #dc3545;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
                tableBody.innerHTML = `<tr><td colspan="8" style="padding: 20px; text-align: center; color: #dc3545;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>`;
            }
        }
        
        function closePoolsModal() {
            document.getElementById('poolsModal').classList.remove('active');
        }
    </script>
    
    <!-- Modal for Pools Distribution -->
    <div class="modal" id="poolsModal">
        <div class="modal-content" style="max-width: 95%; max-height: 90vh; overflow-y: auto;">
            <span class="close" onclick="closePoolsModal()">&times;</span>
            <h2>üí∞ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ –ø—É–ª–∞–º –ø—Ä–æ–µ–∫—Ç–∞</h2>
            <div id="poolsStats" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <p style="color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
            </div>
            <div id="poolsTableContainer" style="overflow-x: auto;">
                <table id="poolsTable" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: #ff6b35; color: white;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">#</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–ü—É–ª</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–ê–¥—Ä–µ—Å</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">–§–∞–∫—Ç–∏—á–µ—Å–∫–∏</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">–†–∞–∑–Ω–∏—Ü–∞</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">% –æ—Ç Total</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody id="poolsTableBody">
                        <tr>
                            <td colspan="8" style="padding: 20px; text-align: center; color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button onclick="closePoolsModal()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
                <button onclick="loadPoolsDistribution()" style="background: #ff6b35; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</body>
</html>

