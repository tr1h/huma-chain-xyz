# 💰 ВИРТУАЛЬНЫЕ VS РЕАЛЬНЫЕ ТОКЕНЫ - КАК ЭТО РАБОТАЕТ?

## ❓ ВОПРОС: "При выводе токенов будут сгорать не настоящие токены же?!"

**ПРАВИЛЬНЫЙ ОТВЕТ:**  
ДА! ✅ При выводе сгорают **ВИРТУАЛЬНЫЕ** токены из базы данных, а **НАСТОЯЩИЕ** (блокчейн) токены **СОЗДАЮТСЯ (mint)** в момент вывода!

---

## 🎮 ДВА ТИПА ТОКЕНОВ В СИСТЕМЕ

```
┌─────────────────────────────────────────────────────────┐
│  ТИП 1: ВИРТУАЛЬНЫЕ ТОКЕНЫ (Database TAMA)              │
├─────────────────────────────────────────────────────────┤
│  • Живут ТОЛЬКО в базе данных (Supabase)                │
│  • Это просто число в столбце: tama = 52046             │
│  • НЕ на блокчейне                                      │
│  • БЕСПЛАТНО создаются (за клики)                       │
│  • БЕСПЛАТНО сгорают (при тратах в игре)                │
│  • Instant (мгновенные операции)                        │
│  • Используются для ИГРОВОЙ экономики                   │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  ТИП 2: РЕАЛЬНЫЕ ТОКЕНЫ (Blockchain TAMA)               │
├─────────────────────────────────────────────────────────┤
│  • Живут на блокчейне Solana                            │
│  • SPL Token (настоящий криптотокен)                    │
│  • Можно увидеть в Phantom кошельке                     │
│  • Можно продать на DEX (Raydium, Jupiter)              │
│  • Имеют РЕАЛЬНУЮ стоимость ($$$)                       │
│  • Стоит gas fee (0.00001 SOL) для транзакций          │
│  • Используются для ВЫВОДА и ТОРГОВЛИ                   │
└─────────────────────────────────────────────────────────┘
```

---

## 🔄 ЖИЗНЕННЫЙ ЦИКЛ ТОКЕНА

### ЭТАП 1: ЗАРАБОТОК (Виртуальные токены)

```sql
-- В базе данных Supabase
UPDATE leaderboard
SET tama = tama + 100  -- ← Виртуальный токен!
WHERE telegram_id = '123456789';

-- Результат:
-- tama: 0 → 100 (в базе данных)
-- Блокчейн: 0 TAMA (ничего не изменилось!)
```

**Что происходит:**
```
Пользователь кликает по питомцу
    ↓
JavaScript: tama += 5
    ↓
Supabase: UPDATE leaderboard SET tama = tama + 5
    ↓
База данных: tama = 52046 (виртуальное число)
    ↓
НА БЛОКЧЕЙНЕ: 0 TAMA (ничего нет!)
```

**Аналогия:**
```
Это как "очки" в видеоигре:
├─ В World of Warcraft у тебя 10,000 золота
├─ Это НЕ настоящее золото!
├─ Это просто число в базе Blizzard
└─ Ты можешь потратить в игре, но не вывести на банковский счет
```

---

### ЭТАП 2: ТРАТЫ В ИГРЕ (Виртуальные токены)

```sql
-- Покупка еды для питомца (в игре)
UPDATE leaderboard
SET tama = tama - 50  -- ← Виртуальное сжигание!
WHERE telegram_id = '123456789';

-- Результат:
-- tama: 52046 → 51996 (в базе)
-- Блокчейн: 0 TAMA (всё ещё ничего нет!)
```

**Что происходит:**
```
Пользователь покупает еду за 50 TAMA
    ↓
JavaScript: tama -= 50
    ↓
Supabase: UPDATE leaderboard SET tama = tama - 50
    ↓
База данных: tama = 51996
    ↓
НА БЛОКЧЕЙНЕ: 0 TAMA (всё ещё пусто!)
```

**Важно:**
- ✅ Это **виртуальное сжигание**
- ✅ Токены просто уменьшаются в базе
- ✅ НЕ ТРАТИТСЯ настоящий блокчейн токен!
- ✅ Бесплатно (no gas fee)

---

### ЭТАП 3: WITHDRAWAL (Превращение виртуальных → реальные)

```python
# В bot.py при /withdraw 10000

# ШАГ 1: Списать ВИРТУАЛЬНЫЕ токены из базы
supabase.table('leaderboard').update({
    'tama': current_balance - 10000  # ← Уменьшить виртуальный баланс
}).eq('telegram_id', telegram_id).execute()

# База: tama = 51996 → 41996 (виртуальные токены ИСЧЕЗЛИ)

# ШАГ 2: СОЗДАТЬ (MINT) НАСТОЯЩИЕ токены на блокчейне
subprocess.run([
    'spl-token', 'transfer',
    TAMA_MINT,
    '9500',  # Net amount (after 5% fee)
    user_wallet_address,
    '--fee-payer', 'payer-keypair.json',
    '--owner', 'payer-keypair.json'  # Mint authority
])

# Блокчейн: 0 TAMA → 9,500 TAMA (настоящие токены СОЗДАНЫ!)
```

**Что происходит:**
```
┌─────────────────────────────────────────┐
│  ДО WITHDRAWAL:                         │
├─────────────────────────────────────────┤
│  База данных: 51,996 TAMA (виртуальные) │
│  Блокчейн: 0 TAMA (реальные)            │
└─────────────────────────────────────────┘
        │
        ▼ /withdraw 10000
        │
┌─────────────────────────────────────────┐
│  Расчёт fee:                            │
│  ├─ Amount: 10,000 TAMA                 │
│  ├─ Fee (5%): 500 TAMA                  │
│  └─ Net: 9,500 TAMA                     │
└─────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────┐
│  ШАГ 1: База данных                     │
│  ├─ Списать: -10,000 виртуальных        │
│  └─ Новый баланс: 41,996 TAMA           │
└─────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────┐
│  ШАГ 2: Fee распределение (виртуальное!)│
│  ├─ 60% (300 TAMA) → "сгорело"          │
│  ├─ 30% (150 TAMA) → вернулось в пул    │
│  └─ 10% (50 TAMA) → команде             │
└─────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────┐
│  ШАГ 3: Блокчейн (spl-token mint)       │
│  ├─ СОЗДАТЬ 9,500 настоящих TAMA        │
│  └─ Отправить на user_wallet            │
└─────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────┐
│  ПОСЛЕ WITHDRAWAL:                      │
├─────────────────────────────────────────┤
│  База данных: 41,996 TAMA (виртуальные) │
│  Блокчейн: 9,500 TAMA (реальные!)       │
└─────────────────────────────────────────┘
```

---

## 🔥 ЧТО СГОРАЕТ ПРИ WITHDRAWAL?

### ❌ НЕПРАВИЛЬНОЕ ПОНИМАНИЕ:

```
"Я вывожу 10,000 TAMA → сгорают настоящие блокчейн токены"
                          ❌ НЕТ! Настоящих токенов ЕЩЁ НЕТ!
```

### ✅ ПРАВИЛЬНОЕ ПОНИМАНИЕ:

```
"Я вывожу 10,000 TAMA → происходит:"

1. Списываются 10,000 ВИРТУАЛЬНЫХ TAMA (из базы)
   ├─ tama: 51996 → 41996 (в базе данных)
   └─ Это "виртуальное сжигание"

2. Fee (500 TAMA) распределяется ВИРТУАЛЬНО:
   ├─ 300 TAMA → записывается как "burned" (в базе!)
   ├─ 150 TAMA → возвращается в daily_pool (в базе!)
   └─ 50 TAMA → team_wallet (в базе!)

3. СОЗДАЁТСЯ 9,500 НАСТОЯЩИХ TAMA (на блокчейне)
   └─ spl-token mint → user_wallet
       └─ Это НОВЫЕ токены, только что созданные!
```

---

## 📊 НАГЛЯДНАЯ ТАБЛИЦА

| Действие | Виртуальные TAMA (База) | Реальные TAMA (Блокчейн) | Total Supply (Реальный) |
|----------|-------------------------|--------------------------|-------------------------|
| Регистрация | 0 | 0 | 0 |
| Клик 1000 раз | +5,000 | 0 | 0 |
| Квест выполнен | +10,000 | 0 | 0 |
| Купил еду | -50 | 0 | 0 |
| Купил игрушку | -200 | 0 | 0 |
| **Текущий баланс** | **14,750** | **0** | **0** |
| **Withdrawal 10,000** | **-10,000** | **+9,500** | **+9,500** |
| **После withdrawal** | **4,750** | **9,500** | **9,500** |

**Важно:**
- Виртуальные токены: БЕСКОНЕЧНЫ (могут создаваться бесплатно)
- Реальные токены: ОГРАНИЧЕНЫ (Total Supply = 1B, но mint по требованию)
- При withdrawal: виртуальные → уничтожаются, реальные → создаются

---

## 💡 ПРАВИЛЬНАЯ ТЕРМИНОЛОГИЯ

### ❌ НЕПРАВИЛЬНО:

```
"При withdrawal сгорают настоящие токены"
→ НЕТ! Настоящих токенов ещё не существует!
```

### ✅ ПРАВИЛЬНО:

```
"При withdrawal:
1. Уничтожаются (списываются) ВИРТУАЛЬНЫЕ токены из базы
2. Распределяется виртуальный fee (burn/pool/team)
3. СОЗДАЮТСЯ (mint) НАСТОЯЩИЕ токены на блокчейне
4. Отправляются на кошелёк пользователя"
```

---

## 🔄 ЧТО ПРОИСХОДИТ С FEE (500 TAMA)?

### Вариант 1: ЧТО СЕЙЧАС (виртуальное сжигание)

```python
# При withdrawal 10,000 TAMA:

# 1. Списать из баланса игрока
supabase.table('leaderboard').update({
    'tama': balance - 10000  # ← Виртуальное уничтожение
}).eq('telegram_id', user_id).execute()

# 2. Записать fee в статистику (виртуально!)
supabase.table('tama_economy').insert({
    'telegram_id': user_id,
    'transaction_type': 'withdrawal',
    'amount': -10000,
    'fee': 500,
    'burn_amount': 300,   # ← Виртуально "сгорело"
    'pool_amount': 150,   # ← Виртуально вернулось
    'team_amount': 50     # ← Виртуально команде
}).execute()

# 3. Обновить глобальную статистику
supabase.rpc('update_burn_stats', {
    'burned': 300,    # ← Счётчик "сожжённых" виртуальных токенов
    'recycled': 150   # ← Счётчик "переработанных" виртуальных токенов
}).execute()

# 4. Mint НАСТОЯЩИЕ токены (только net amount!)
subprocess.run([
    'spl-token', 'transfer',
    TAMA_MINT,
    '9500',  # ← Только чистая сумма (без fee)
    user_wallet
])
```

**Результат:**
```
┌──────────────────────────────────────────┐
│  Виртуальные токены:                     │
│  ├─ 10,000 TAMA исчезли из базы          │
│  ├─ 300 TAMA "сгорели" (статистика)      │
│  ├─ 150 TAMA "вернулись" (статистика)    │
│  └─ 50 TAMA "команде" (статистика)       │
│                                          │
│  Реальные токены:                        │
│  └─ 9,500 TAMA созданы на блокчейне      │
└──────────────────────────────────────────┘

ВАЖНО:
- Fee (500 TAMA) НЕ СОЗДАЁТСЯ на блокчейне!
- Fee остаётся "виртуальным"
- На блокчейне создаётся только 9,500 TAMA
```

---

### Вариант 2: АЛЬТЕРНАТИВА (реальное сжигание fee)

```python
# Если хочешь чтобы fee РЕАЛЬНО сжигался на блокчейне:

# 1. Mint ПОЛНУЮ сумму (10,000 TAMA)
subprocess.run([
    'spl-token', 'transfer',
    TAMA_MINT,
    '10000',  # ← Полная сумма
    temporary_vault  # ← Временный кошелёк
])

# 2. Transfer net amount пользователю (9,500 TAMA)
subprocess.run([
    'spl-token', 'transfer',
    temporary_vault,
    '9500',
    user_wallet
])

# 3. РЕАЛЬНО сжечь 300 TAMA на блокчейне
subprocess.run([
    'spl-token', 'burn',
    temporary_vault,
    '300'  # ← Настоящее сжигание!
])

# 4. Transfer pool amount (150 TAMA)
subprocess.run([
    'spl-token', 'transfer',
    temporary_vault,
    '150',
    daily_pool_wallet
])

# 5. Transfer team amount (50 TAMA)
subprocess.run([
    'spl-token', 'transfer',
    temporary_vault,
    '50',
    team_wallet
])
```

**Результат:**
```
┌──────────────────────────────────────────┐
│  Виртуальные токены:                     │
│  └─ 10,000 TAMA исчезли из базы          │
│                                          │
│  Реальные токены:                        │
│  ├─ 10,000 TAMA созданы                  │
│  ├─ 9,500 TAMA → user_wallet             │
│  ├─ 300 TAMA → BURNED (реально!)         │
│  ├─ 150 TAMA → daily_pool_wallet         │
│  └─ 50 TAMA → team_wallet                │
└──────────────────────────────────────────┘

ВАЖНО:
- Fee РЕАЛЬНО сжигается на блокчейне
- Total Supply увеличивается на 10,000
- Но 300 сразу сжигается
- Effective Supply: +9,700 TAMA
```

---

## 🎯 КАКОЙ ВАРИАНТ ЛУЧШЕ?

### ВАРИАНТ 1: Виртуальное сжигание fee (текущая реализация) ✅

**Плюсы:**
- ✅ Проще реализовать
- ✅ Дешевле (меньше транзакций)
- ✅ Быстрее (1 транзакция вместо 5)
- ✅ Меньше gas fees

**Минусы:**
- ❌ Fee не "настоящий burn" на блокчейне
- ❌ Total Supply на блокчейне != виртуальному supply

**Когда использовать:**
- ✅ Сейчас (Hackathon/MVP)
- ✅ Пока withdrawal редкие
- ✅ Для простоты

---

### ВАРИАНТ 2: Реальное сжигание fee (advanced) 🔥

**Плюсы:**
- ✅ Полная прозрачность (всё на блокчейне)
- ✅ Настоящая дефляция (burn виден в блокчейне)
- ✅ Total Supply точный

**Минусы:**
- ❌ Сложнее реализовать
- ❌ Дороже (5 транзакций вместо 1)
- ❌ Медленнее (~30-60 секунд)
- ❌ Больше gas fees (~0.00005 SOL вместо 0.00001)

**Когда использовать:**
- ✅ В будущем (Production)
- ✅ Когда много withdrawal
- ✅ Для полной децентрализации

---

## 🚀 РЕКОМЕНДАЦИЯ

### Для сейчас (Hackathon):
```
ВАРИАНТ 1: Виртуальное сжигание ✅

При withdrawal:
├─ Списать 10,000 виртуальных TAMA (база)
├─ Записать fee в статистику (база)
├─ Mint только 9,500 настоящих TAMA (блокчейн)
└─ Отправить пользователю

Это проще, быстрее, дешевле!
```

### Для будущего (Production):
```
ВАРИАНТ 2: Реальное сжигание 🔥

При withdrawal:
├─ Mint 10,000 настоящих TAMA
├─ Transfer 9,500 пользователю
├─ Burn 300 на блокчейне (настоящее!)
├─ Transfer 150 в daily pool
└─ Transfer 50 команде

Это прозрачнее, но сложнее!
```

---

## 📝 SUMMARY

```
┌────────────────────────────────────────────────────────┐
│  ЧТО СГОРАЕТ ПРИ WITHDRAWAL?                           │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ВИРТУАЛЬНЫЕ ТОКЕНЫ (база данных):                     │
│  ├─ 10,000 TAMA списываются с баланса игрока          │
│  ├─ 300 TAMA "сгорают" (счётчик в базе)               │
│  ├─ 150 TAMA "возвращаются" (счётчик в базе)          │
│  └─ 50 TAMA "команде" (счётчик в базе)                │
│                                                        │
│  РЕАЛЬНЫЕ ТОКЕНЫ (блокчейн):                           │
│  ├─ 9,500 TAMA СОЗДАЮТСЯ (mint)                       │
│  └─ Отправляются на user_wallet                       │
│                                                        │
│  ВАЖНО:                                                │
│  • Fee (500 TAMA) НЕ СОЗДАЁТСЯ на блокчейне!          │
│  • Сгорают ВИРТУАЛЬНЫЕ токены, не настоящие!          │
│  • Настоящие токены ТОЛЬКО СОЗДАЮТСЯ (mint)!          │
│  • НЕТ "сжигания" настоящих токенов при withdrawal!   │
│                                                        │
└────────────────────────────────────────────────────────┘
```

---

## ✅ ОТВЕТ НА ТВОЙ ВОПРОС

### Вопрос:
> "При выводе токенов будут сгорать не настоящие токены же?!"

### Ответ:
**ДА, ТЫ ПРАВ!** ✅

- ✅ Сгорают **ВИРТУАЛЬНЫЕ** токены (из базы данных)
- ✅ Fee распределяется **ВИРТУАЛЬНО** (счётчики в базе)
- ✅ Настоящие токены **СОЗДАЮТСЯ** (mint) в момент withdrawal
- ✅ На блокчейн отправляется только **net amount** (9,500 TAMA)
- ✅ Fee (500 TAMA) остаётся "виртуальным"

**Это ПРАВИЛЬНО и ЭКОНОМИЧНО!** 🎯

---

**Вопросы? Хочешь:**
- A. Оставить как есть (виртуальное сжигание) ✅
- B. Перейти на реальное сжигание (сложнее) 🔥
- C. Узнать больше про токеномику 📚

**Говори!** 💪

