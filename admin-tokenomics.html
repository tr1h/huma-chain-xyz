<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokenomics Dashboard - TAMA</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { 
            background: rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px);
            border-radius: 15px; 
            padding: 25px;
            border: 2px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card h3 { font-size: 0.9em; opacity: 0.9; margin-bottom: 10px; }
        .stat-card .big-number { font-size: 2em; font-weight: bold; margin: 10px 0; }
        .stat-card small { opacity: 0.8; font-size: 0.85em; }
        .chart-container { 
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid rgba(255,255,255,0.2);
        }
        .withdrawal-table { 
            width: 100%;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.2);
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; }
        th { background: rgba(0,0,0,0.3); font-weight: 600; }
        tr:nth-child(even) { background: rgba(255,255,255,0.05); }
        .btn { 
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px 5px;
            transition: transform 0.2s ease;
        }
        .btn:hover { transform: scale(1.05); }
        .progress-bar { 
            width: 100%;
            height: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill { 
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ TAMA TOKENOMICS DASHBOARD</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>üìä TOTAL SUPPLY</h3>
                <div class="big-number">1,000,000,000</div>
                <small>Fixed maximum supply</small>
            </div>
            
            <div class="stat-card">
                <h3>üí´ CIRCULATING SUPPLY</h3>
                <div class="big-number" id="circulating">0</div>
                <small>Actually withdrawn to wallets</small>
            </div>
            
            <div class="stat-card">
                <h3>üî• BURNED (Virtual)</h3>
                <div class="big-number" id="burned">0</div>
                <small>From withdrawal fees (60%)</small>
            </div>
            
            <div class="stat-card">
                <h3>üíß DAILY POOL</h3>
                <div class="big-number">2,222,222</div>
                <small>Year 1 H1 (400M / 180 days)</small>
            </div>
        </div>

        <div class="chart-container">
            <h2>‚è∞ HALVING COUNTDOWN</h2>
            <p id="halving-text">Next halving in <strong id="days-left">180</strong> days</p>
            <div class="progress-bar">
                <div class="progress-fill" id="halving-progress" style="width: 0%">0%</div>
            </div>
            <small>After halving: Daily Pool will be 1,111,111 TAMA/day</small>
        </div>

        <div class="chart-container">
            <h2>üìà TOKEN EMISSION CHART</h2>
            <canvas id="emissionChart"></canvas>
        </div>

        <div class="chart-container">
            <h2>üí∏ RECENT WITHDRAWALS</h2>
            <button class="btn" onclick="loadWithdrawals()">üîÑ Refresh</button>
            <div class="withdrawal-table">
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>User</th>
                            <th>Amount</th>
                            <th>Fee</th>
                            <th>Net</th>
                            <th>Signature</th>
                        </tr>
                    </thead>
                    <tbody id="withdrawals-list">
                        <tr><td colspan="6" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Supabase connection
        const SUPABASE_URL = 'https://zfrazyupameidxpjihrh.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmcmF6eXVwYW1laWR4cGppaHJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA0NzIwMzcsImV4cCI6MjA0NjA0ODAzN30.h0KiPo1jTrUCcZCbnD6EMxC51PkxGnpnqPNqjZ3kzSM';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Load statistics
        async function loadStats() {
            try {
                // Get total withdrawn (circulating supply)
                const { data: withdrawals } = await supabase
                    .from('tama_transactions')
                    .select('amount')
                    .eq('type', 'withdrawal');
                
                const circulating = Math.abs(withdrawals?.reduce((sum, tx) => sum + Math.abs(tx.amount), 0) || 0);
                document.getElementById('circulating').textContent = circulating.toLocaleString();
                
                // Calculate burned (60% of fees)
                const burned = Math.floor(circulating * 0.05 * 0.60);
                document.getElementById('burned').textContent = burned.toLocaleString();
                
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load withdrawals
        async function loadWithdrawals() {
            try {
                const { data } = await supabase
                    .from('tama_transactions')
                    .select('*')
                    .eq('type', 'withdrawal')
                    .order('created_at', { ascending: false })
                    .limit(50);
                
                const tbody = document.getElementById('withdrawals-list');
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No withdrawals yet</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.map(tx => {
                    const amount = Math.abs(tx.amount);
                    const fee = Math.floor(amount * 0.05);
                    const net = amount - fee;
                    const time = new Date(tx.created_at).toLocaleString();
                    const sig = tx.signature ? tx.signature.substring(0, 8) + '...' : 'N/A';
                    
                    return `
                        <tr>
                            <td>${time}</td>
                            <td>${tx.telegram_id}</td>
                            <td>${amount.toLocaleString()} TAMA</td>
                            <td>${fee.toLocaleString()} TAMA</td>
                            <td>${net.toLocaleString()} TAMA</td>
                            <td><code>${sig}</code></td>
                        </tr>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading withdrawals:', error);
            }
        }

        // Halving countdown
        function updateHalvingCountdown() {
            const launchDate = new Date('2025-11-01');
            const halvingDate = new Date(launchDate);
            halvingDate.setDate(halvingDate.getDate() + 180);
            
            const now = new Date();
            const daysLeft = Math.max(0, Math.floor((halvingDate - now) / (1000 * 60 * 60 * 24)));
            const progress = Math.min(100, ((180 - daysLeft) / 180) * 100);
            
            document.getElementById('days-left').textContent = daysLeft;
            document.getElementById('halving-progress').style.width = progress + '%';
            document.getElementById('halving-progress').textContent = progress.toFixed(1) + '%';
        }

        // Emission chart
        function createEmissionChart() {
            const ctx = document.getElementById('emissionChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5-8'],
                    datasets: [{
                        label: 'TAMA Emission (Millions)',
                        data: [600, 150, 37.5, 9.375, 2.125],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#fff' } },
                        title: { display: true, text: 'Bitcoin-Style Halving Schedule', color: '#fff' }
                    },
                    scales: {
                        y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadWithdrawals();
            updateHalvingCountdown();
            createEmissionChart();
            
            // Auto-refresh every 30 seconds
            setInterval(() => {
                loadStats();
                loadWithdrawals();
                updateHalvingCountdown();
            }, 30000);
        });
    </script>
</body>
</html>

