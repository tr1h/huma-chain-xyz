<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokenomics Dashboard - TAMA</title>
    <!-- Admin Password (for production) -->
    <meta name="admin-password-hash" content="86303a8eab5693506714a32875b556fd84daf2209f184459642af6e153da3ff3">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        /* Admin Login Screen */
        #adminLoginScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-container h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 28px;
        }

        #adminPasswordInput {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }

        #adminPasswordInput:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .login-btn:hover {
            background: #5568d3;
        }

        #adminLoginError {
            color: red;
            margin-top: 15px;
            min-height: 20px;
            font-size: 14px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card h3 { font-size: 0.9em; opacity: 0.9; margin-bottom: 10px; }
        .stat-card .big-number { font-size: 2em; font-weight: bold; margin: 10px 0; }
        .stat-card small { opacity: 0.8; font-size: 0.85em; }
        .chart-container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid rgba(255,255,255,0.2);
        }
        .withdrawal-table {
            width: 100%;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.2);
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; }
        th { background: rgba(0,0,0,0.3); font-weight: 600; }
        tr:nth-child(even) { background: rgba(255,255,255,0.05); }
        .btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px 5px;
            transition: transform 0.2s ease;
        }
        .btn:hover { transform: scale(1.05); }
        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Logo Styles üé® */
        .game-logo {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 10000;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .game-logo:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }

        .game-logo img {
            height: 70px;
            width: auto;
            display: block;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 5px;
        }

        @media (max-width: 768px) {
            .game-logo {
                top: 10px;
                left: 10px;
            }

            .game-logo img {
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- Logo üé® -->
    <a href="index.html" class="game-logo" title="Back to Home">
        <img src="logo.png" alt="Solana Tamagotchi">
    </a>

    <!-- Admin Login Screen -->
    <div id="adminLoginScreen">
        <div class="login-container">
            <h2>üîê Admin Access</h2>
            <input type="password" id="adminPasswordInput" placeholder="Enter password">
            <button class="login-btn" onclick="adminAuth.checkPassword()">Login</button>
            <div id="adminLoginError"></div>
        </div>
    </div>

    <!-- Main Content (hidden until authenticated) -->
    <div id="adminContent" style="display: none;">
    <div class="container">
        <h1>üí∞ TAMA TOKENOMICS DASHBOARD</h1>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>üìä TOTAL SUPPLY</h3>
                <div class="big-number">1,000,000,000</div>
                <small>Fixed maximum supply</small>
            </div>

            <div class="stat-card">
                <h3>üí´ CIRCULATING SUPPLY</h3>
                <div class="big-number" id="circulating">0</div>
                <small>Actually withdrawn to wallets</small>
            </div>

            <div class="stat-card">
                <h3>üî• BURNED (Virtual)</h3>
                <div class="big-number" id="burned">0</div>
                <small>From withdrawal fees (60%)</small>
            </div>

            <div class="stat-card">
                <h3>üíß DAILY POOL</h3>
                <div class="big-number" id="daily-pool">1,111,111</div>
                <small id="daily-pool-period">Year 1 H1 (200M / 180 days)</small>
            </div>
        </div>

        <div class="chart-container">
            <h2>‚è∞ HALVING COUNTDOWN</h2>
            <p id="halving-text">Next halving in <strong id="days-left">180</strong> days</p>
            <div class="progress-bar">
                <div class="progress-fill" id="halving-progress" style="width: 0%">0%</div>
            </div>
            <small id="halving-countdown">After halving: Daily Pool will be 555,555 TAMA/day (Year 1 H2: 100M)</small>
        </div>

        <div class="chart-container">
            <h2>üìà TOKEN EMISSION CHART</h2>
            <canvas id="emissionChart"></canvas>
        </div>

        <div class="chart-container">
            <h2>üé® NFT MINTS (TAMA Payment)</h2>
            <button class="btn" onclick="loadNFTMints()">üîÑ Refresh</button>
            <div style="margin-bottom: 15px;">
                <div class="stat-card" style="display: inline-block; margin-right: 15px;">
                    <h4>Total NFTs Minted</h4>
                    <div class="big-number" style="font-size: 24px;" id="total-nfts">0</div>
                </div>
                <div class="stat-card" style="display: inline-block;">
                    <h4>TAMA Spent on NFTs</h4>
                    <div class="big-number" style="font-size: 24px;" id="total-tama-spent">0</div>
                </div>
            </div>
            <div class="withdrawal-table">
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>User</th>
                            <th>Tier</th>
                            <th>Rarity</th>
                            <th>Multiplier</th>
                            <th>TAMA Price</th>
                        </tr>
                    </thead>
                    <tbody id="nft-mints-list">
                        <tr><td colspan="6" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="chart-container">
            <h2>üåê TAMA BLOCKCHAIN TRANSACTIONS</h2>
            <button class="btn" onclick="loadBlockchainTx()">üîÑ Refresh</button>
            <div style="margin-bottom: 15px;">
                <div class="stat-card" style="display: inline-block; margin-right: 15px;">
                    <h4>P2E Pool Refunds</h4>
                    <div class="big-number" style="font-size: 24px; color: #10b981;" id="total-p2e-refunds">0</div>
                </div>
                <div class="stat-card" style="display: inline-block; margin-right: 15px;">
                    <h4>Treasury Income</h4>
                    <div class="big-number" style="font-size: 24px; color: #f59e0b;" id="total-treasury">0</div>
                </div>
                <div class="stat-card" style="display: inline-block;">
                    <h4>Burned (Virtual)</h4>
                    <div class="big-number" style="font-size: 24px; color: #ef4444;" id="total-burned-virtual">0</div>
                </div>
            </div>
            <div class="withdrawal-table">
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Signature</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody id="blockchain-tx-list">
                        <tr><td colspan="5" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="chart-container">
            <h2>üí∏ RECENT WITHDRAWALS</h2>
            <button class="btn" onclick="loadWithdrawals()">üîÑ Refresh</button>
            <div class="withdrawal-table">
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>User</th>
                            <th>Amount</th>
                            <th>Fee</th>
                            <th>Net</th>
                            <th>Signature</th>
                        </tr>
                    </thead>
                    <tbody id="withdrawals-list">
                        <tr><td colspan="6" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Supabase connection (UPDATED)
        const SUPABASE_URL = 'https://zfrazyupameidxpjihrh.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmcmF6eXVwYW1laWR4cGppaHJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5Mzc1NTAsImV4cCI6MjA3NTUxMzU1MH0.1EkMDqCNJoAjcJDh3Dd3yPfus-JpdcwE--z2dhjh7wU';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Load statistics
        async function loadStats() {
            try {
                // Try multiple table names and column names
                let withdrawals = [];
                let error = null;

                // Try tama_economy with transaction_type
                let result = await supabase
                    .from('tama_economy')
                    .select('amount')
                    .eq('transaction_type', 'withdrawal');

                if (result.error && result.error.code !== 'PGRST116') {
                    // Try withdrawals table
                    result = await supabase
                        .from('withdrawals')
                        .select('amount');
                }

                if (result.error && result.error.code !== 'PGRST116') {
                    // Try leaderboard total_withdrawn
                    result = await supabase
                        .from('leaderboard')
                        .select('total_withdrawn');

                    if (!result.error && result.data) {
                        // total_withdrawn —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç net amount (–ø–æ—Å–ª–µ fee)
                        const circulating = result.data.reduce((sum, user) => sum + (user.total_withdrawn || 0), 0);
                        document.getElementById('circulating').textContent = circulating.toLocaleString();
                        // –ü–†–ê–í–ò–õ–¨–ù–û: –°—á–∏—Ç–∞—Ç—å burned –æ—Ç —Å—É–º–º—ã –≤—Å–µ—Ö fee
                        // –ï—Å–ª–∏ total_withdrawn = net amount, —Ç–æ fee = withdrawn / 0.95 * 0.05
                        const totalWithdrawn = circulating;
                        const totalAmount = totalWithdrawn / 0.95;  // –í–µ—Ä–Ω—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—É–º–º–µ (–¥–æ fee)
                        const totalFees = totalAmount - totalWithdrawn;
                        const burned = Math.floor(totalFees * 0.60);
                        document.getElementById('burned').textContent = burned.toLocaleString();
                        return;
                    }
                }

                if (result.error) {
                    console.error('Supabase error:', result.error);
                    document.getElementById('circulating').textContent = '0';
                    document.getElementById('burned').textContent = '0';
                    return;
                }

                withdrawals = result.data || [];
                // –ü–†–ê–í–ò–õ–¨–ù–û: –°—á–∏—Ç–∞—Ç—å –æ—Ç amount_sent (—Ä–µ–∞–ª—å–Ω–æ –≤—ã–≤–µ–¥–µ–Ω–æ), –∞ –Ω–µ –æ—Ç amount
                const circulating = withdrawals.reduce((sum, tx) => {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º amount_sent (net amount) –∏–ª–∏ amount - fee
                    const amountSent = tx.amount_sent || tx.net_amount || (Math.abs(tx.amount || 0) * 0.95);
                    return sum + Math.abs(amountSent);
                }, 0);
                document.getElementById('circulating').textContent = circulating.toLocaleString();

                // –ü–†–ê–í–ò–õ–¨–ù–û: –°—á–∏—Ç–∞—Ç—å burned –æ—Ç —Å—É–º–º—ã –≤—Å–µ—Ö fee, –∞ –Ω–µ –æ—Ç circulating
                const totalFees = withdrawals.reduce((sum, tx) => {
                    const fee = tx.fee || Math.floor(Math.abs(tx.amount || 0) * 0.05);
                    return sum + fee;
                }, 0);
                const burned = Math.floor(totalFees * 0.60);  // 60% –æ—Ç fee —Å–∂–∏–≥–∞–µ—Ç—Å—è
                document.getElementById('burned').textContent = burned.toLocaleString();

            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('circulating').textContent = '0';
                document.getElementById('burned').textContent = '0';
            }
        }

        // Load withdrawals
        async function loadWithdrawals() {
            try {
                const tbody = document.getElementById('withdrawals-list');
                let result = null;

                // Try multiple table names
                // 1. Try tama_economy with transaction_type
                result = await supabase
                    .from('tama_economy')
                    .select('*')
                    .eq('transaction_type', 'withdrawal')
                    .order('created_at', { ascending: false })
                    .limit(50);

                if (result.error && result.error.code !== 'PGRST116') {
                    // 2. Try withdrawals table
                    result = await supabase
                        .from('withdrawals')
                        .select('*')
                        .order('created_at', { ascending: false })
                        .limit(50);
                }

                if (result.error) {
                    console.error('Supabase error:', result.error);
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#ef4444;">Table not found. Please create tama_economy or withdrawals table in Supabase.</td></tr>';
                    return;
                }

                const data = result.data || [];

                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No withdrawals yet</td></tr>';
                    return;
                }

                tbody.innerHTML = data.map(tx => {
                    const amount = Math.abs(tx.amount || 0);
                    const fee = Math.floor(amount * 0.05);
                    const net = amount - fee;
                    const time = new Date(tx.created_at || tx.completed_at || Date.now()).toLocaleString();
                    const sig = (tx.signature || tx.tx_signature || '').substring(0, 8) + '...' || 'N/A';
                    const telegramId = tx.telegram_id || 'N/A';

                    return `
                        <tr>
                            <td>${time}</td>
                            <td>${telegramId}</td>
                            <td>${amount.toLocaleString()} TAMA</td>
                            <td>${fee.toLocaleString()} TAMA</td>
                            <td>${net.toLocaleString()} TAMA</td>
                            <td><code>${sig}</code></td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading withdrawals:', error);
                const tbody = document.getElementById('withdrawals-list');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#ef4444;">Error: ' + error.message + '</td></tr>';
            }
        }

        // Load NFT Mints (from transactions table)
        async function loadNFTMints() {
            try {
                const tbody = document.getElementById('nft-mints-list');

                // Load NFT mint transactions
                const result = await supabase
                    .from('transactions')
                    .select('*')
                    .eq('type', 'nft_mint')
                    .order('created_at', { ascending: false })
                    .limit(50);

                if (result.error) {
                    console.error('Supabase error:', result.error);
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#ef4444;">Error loading NFT mints</td></tr>';
                    return;
                }

                const data = result.data || [];

                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No NFT mints yet</td></tr>';
                    document.getElementById('total-nfts').textContent = '0';
                    document.getElementById('total-tama-spent').textContent = '0 TAMA';
                    return;
                }

                // Calculate totals
                const totalNFTs = data.length;
                const totalTAMA = data.reduce((sum, tx) => sum + Math.abs(tx.amount || 0), 0);
                document.getElementById('total-nfts').textContent = totalNFTs.toLocaleString();
                document.getElementById('total-tama-spent').textContent = totalTAMA.toLocaleString() + ' TAMA';

                // Render table
                tbody.innerHTML = data.map(tx => {
                    const metadata = typeof tx.metadata === 'string' ? JSON.parse(tx.metadata) : tx.metadata;
                    const time = new Date(tx.created_at || Date.now()).toLocaleString();
                    const tier = metadata?.tier || 'N/A';
                    const rarity = metadata?.rarity || 'N/A';
                    const multiplier = metadata?.multiplier || 'N/A';
                    const price = Math.abs(tx.amount || 0);

                    return `
                        <tr>
                            <td>${time}</td>
                            <td>${tx.user_id || 'N/A'}</td>
                            <td><strong>${tier}</strong></td>
                            <td>${rarity}</td>
                            <td style="color: #10b981; font-weight: bold;">${multiplier}x</td>
                            <td><strong>${price.toLocaleString()} TAMA</strong></td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading NFT mints:', error);
                const tbody = document.getElementById('nft-mints-list');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#ef4444;">Error: ' + error.message + '</td></tr>';
            }
        }

        // Load Blockchain Transactions (P2E Pool, Treasury, Burn)
        async function loadBlockchainTx() {
            try {
                const tbody = document.getElementById('blockchain-tx-list');

                // Load blockchain-related transactions
                const result = await supabase
                    .from('transactions')
                    .select('*')
                    .in('type', ['p2e_pool_refund_from_nft_onchain', 'treasury_income_from_nft_onchain', 'burn_from_bronze_nft_onchain', 'tama_burn'])
                    .order('created_at', { ascending: false })
                    .limit(50);

                if (result.error) {
                    console.error('Supabase error:', result.error);
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#ef4444;">Error loading blockchain transactions</td></tr>';
                    return;
                }

                const data = result.data || [];

                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No blockchain transactions yet</td></tr>';
                    document.getElementById('total-p2e-refunds').textContent = '0 TAMA';
                    document.getElementById('total-treasury').textContent = '0 TAMA';
                    document.getElementById('total-burned-virtual').textContent = '0 TAMA';
                    return;
                }

                // Calculate totals
                const p2eTotal = data.filter(tx => tx.type === 'p2e_pool_refund').reduce((sum, tx) => sum + Math.abs(tx.amount || 0), 0);
                const treasuryTotal = data.filter(tx => tx.type === 'treasury_income').reduce((sum, tx) => sum + Math.abs(tx.amount || 0), 0);
                const burnedTotal = data.filter(tx => tx.type.includes('burn')).reduce((sum, tx) => sum + Math.abs(tx.amount || 0), 0);

                document.getElementById('total-p2e-refunds').textContent = p2eTotal.toLocaleString() + ' TAMA';
                document.getElementById('total-treasury').textContent = treasuryTotal.toLocaleString() + ' TAMA';
                document.getElementById('total-burned-virtual').textContent = burnedTotal.toLocaleString() + ' TAMA';

                // Render table
                tbody.innerHTML = data.map(tx => {
                    const metadata = typeof tx.metadata === 'string' ? JSON.parse(tx.metadata) : tx.metadata;
                    const time = new Date(tx.created_at || Date.now()).toLocaleString();
                    const amount = Math.abs(tx.amount || 0);
                    const signature = metadata?.transaction_signature?.substring(0, 8) + '...' || 'N/A';
                    const explorerUrl = metadata?.transaction_signature
                        ? `https://explorer.solana.com/tx/${metadata.transaction_signature}?cluster=devnet`
                        : '#';

                    // Type labels with emojis
                    const typeLabels = {
                        'p2e_pool_refund': 'üéÆ P2E Pool Refund',
                        'treasury_income': 'üè¶ Treasury Income',
                        'burn_from_bronze_nft': 'üî• NFT Burn',
                        'burn_from_withdrawal': 'üî• Withdrawal Burn'
                    };
                    const typeLabel = typeLabels[tx.type] || tx.type;

                    return `
                        <tr>
                            <td>${time}</td>
                            <td><strong>${typeLabel}</strong></td>
                            <td style="font-weight: bold;">${amount.toLocaleString()} TAMA</td>
                            <td><a href="${explorerUrl}" target="_blank" style="color: #a78bfa;"><code>${signature}</code></a></td>
                            <td>${metadata?.tier || metadata?.source || 'N/A'}</td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading blockchain transactions:', error);
                const tbody = document.getElementById('blockchain-tx-list');
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#ef4444;">Error: ' + error.message + '</td></tr>';
            }
        }

        // Calculate P2E Pool info
        function calculateP2EPoolInfo() {
            const launchDate = new Date('2025-11-01');
            const now = new Date();
            const daysSinceLaunch = Math.floor((now - launchDate) / (1000 * 60 * 60 * 24));

            // –ü–µ—Ä–∏–æ–¥—ã –∏ –∏—Ö –ø—É–ª—ã (400M –≤—Å–µ–≥–æ, —Å–æ–≥–ª–∞—Å–Ω–æ whitepaper)
            // –ö–∞–∂–¥–æ–µ –ø–æ–ª—É–≥–æ–¥–∏–µ = 180 –¥–Ω–µ–π
            const periods = [
                { name: 'Year 1 H1', pool: 200000000, daily: 1111111, days: 180 }, // 200M / 180 = 1.1M/day
                { name: 'Year 1 H2', pool: 100000000, daily: 555556, days: 180 },  // 100M / 180 = 555K/day
                { name: 'Year 2 H1', pool: 50000000, daily: 277778, days: 180 },   // 50M / 180 = 278K/day
                { name: 'Year 2 H2', pool: 25000000, daily: 138889, days: 180 },   // 25M / 180 = 139K/day
                { name: 'Year 3 H1', pool: 12500000, daily: 69444, days: 180 },    // 12.5M / 180 = 69K/day
                { name: 'Year 3 H2', pool: 6250000, daily: 34722, days: 180 },     // 6.25M / 180 = 35K/day
                { name: 'Year 4 H1', pool: 3125000, daily: 17361, days: 180 },     // 3.125M / 180 = 17K/day
                { name: 'Year 4 H2', pool: 3125000, daily: 17361, days: 180 }      // 3.125M / 180 = 17K/day
            ];

            // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥ (—Å —É—á–µ—Ç–æ–º —Ä–∞–∑–Ω—ã—Ö –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –ø–µ—Ä–∏–æ–¥–æ–≤)
            let periodNumber = 0;
            let daysInPeriod = daysSinceLaunch;
            let daysLeftInPeriod = 0;

            // –ù–∞–π—Ç–∏ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥
            for (let i = 0; i < periods.length; i++) {
                if (daysInPeriod < periods[i].days) {
                    periodNumber = i;
                    daysLeftInPeriod = periods[i].days - daysInPeriod;
                    break;
                }
                daysInPeriod -= periods[i].days;
            }

            // –ï—Å–ª–∏ –≤—Å–µ –ø–µ—Ä–∏–æ–¥—ã –ø—Ä–æ—à–ª–∏
            if (periodNumber >= periods.length) {
                periodNumber = periods.length - 1;
                daysInPeriod = periods[periodNumber].days;
                daysLeftInPeriod = 0;
            }

            const currentPeriod = periods[periodNumber] || periods[periods.length - 1];
            const nextPeriod = periods[periodNumber + 1] || null;

            // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–Ω–µ–π
            const distributed = Math.min(daysInPeriod * currentPeriod.daily, currentPeriod.pool);
            const remaining = Math.max(0, currentPeriod.pool - distributed);

            return {
                currentPeriod: currentPeriod.name,
                dailyPool: currentPeriod.daily,
                initialPool: currentPeriod.pool,
                distributed: distributed,
                remaining: remaining,
                daysInPeriod: daysInPeriod,
                daysLeft: daysLeftInPeriod,
                nextPeriod: nextPeriod ? nextPeriod.name : 'End',
                nextDailyPool: nextPeriod ? nextPeriod.daily : 0
            };
        }

        // Update Daily Pool display
        function updateDailyPool() {
            const poolInfo = calculateP2EPoolInfo();
            document.getElementById('daily-pool').textContent = poolInfo.dailyPool.toLocaleString();
            document.getElementById('daily-pool-period').textContent =
                `${poolInfo.currentPeriod} (${(poolInfo.remaining / 1000000).toFixed(1)}M remaining)`;
        }

        // Halving countdown
        function updateHalvingCountdown() {
            const poolInfo = calculateP2EPoolInfo();
            const daysLeft = poolInfo.daysLeft;
            const progress = (poolInfo.daysInPeriod / 180) * 100;

            document.getElementById('days-left').textContent = daysLeft;
            document.getElementById('halving-progress').style.width = progress + '%';
            document.getElementById('halving-progress').textContent = progress.toFixed(1) + '%';

            // Update halving text
            const halvingNote = document.getElementById('halving-countdown');
            if (poolInfo.nextPeriod !== 'End') {
                document.getElementById('halving-text').innerHTML =
                    `Next halving in <strong>${daysLeft}</strong> days<br>` +
                    `<small>Current: ${poolInfo.currentPeriod} ‚Üí Next: ${poolInfo.nextPeriod}</small>`;
                if (halvingNote) {
                    halvingNote.textContent = `After halving: Daily Pool will be ${poolInfo.nextDailyPool.toLocaleString()} TAMA/day`;
                }
            } else {
                document.getElementById('halving-text').innerHTML =
                    `<strong>All halvings completed</strong><br>` +
                    `<small>Current: ${poolInfo.currentPeriod}</small>`;
                if (halvingNote) {
                    halvingNote.textContent = `Final period: ${poolInfo.currentPeriod}`;
                }
            }
        }

        // Emission chart
        function createEmissionChart() {
            const ctx = document.getElementById('emissionChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5-8'],
                    datasets: [{
                        label: 'TAMA Emission (Millions)',
                        data: [600, 150, 37.5, 9.375, 2.125],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#fff' } },
                        title: { display: true, text: 'Bitcoin-Style Halving Schedule', color: '#fff' }
                    },
                    scales: {
                        y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadNFTMints();
            loadBlockchainTx();
            loadWithdrawals();
            updateDailyPool();
            updateHalvingCountdown();
            createEmissionChart();

            // Auto-refresh every 30 seconds
            setInterval(() => {
                loadStats();
                loadNFTMints();
                loadBlockchainTx();
                loadWithdrawals();
                updateDailyPool();
                updateHalvingCountdown();
            }, 30000);
        });
    </script>
    </div> <!-- End of adminContent -->

    <!-- Admin Authentication -->
    <script src="admin-password.js"></script>
    <script src="js/admin-auth.js"></script>
</body>
</html>

