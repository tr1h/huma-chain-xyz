# üîç Debug Guide: Data Sync Issue

## –ü—Ä–æ–±–ª–µ–º–∞
–†–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –¥–ª—è –æ–¥–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞:
- –¢–µ–ª–µ—Ñ–æ–Ω: Level 4, 8844 TAMA
- –ö–æ–º–ø—å—é—Ç–µ—Ä: Level 1, 121 TAMA

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **Consistent User ID Handling**
   - `userId` –≤—Å–µ–≥–¥–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫—É
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ `userId`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è `telegram_id` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏

2. **Detailed Logging**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Supabase
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç API
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

3. **Multiple Records Handling**
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∞–º–∞—è —Å–≤–µ–∂–∞—è (–ø–æ `last_activity`)

4. **Rank Display**
   - –£–ª—É—á—à–µ–Ω `fetchUserRank()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç count query –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ–±–æ–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

**–ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**
1. –û—Ç–∫—Ä–æ–π –∏–≥—Ä—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ù–∞–∂–º–∏ `F12` ‚Üí –≤–∫–ª–∞–¥–∫–∞ "Console"
3. –û—á–∏—Å—Ç–∏ –∫–æ–Ω—Å–æ–ª—å (`Ctrl+L`)
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É (`F5`)

**–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:**
1. –û—Ç–∫—Ä–æ–π –∏–≥—Ä—É –≤ Telegram
2. –û—Ç–∫—Ä–æ–π DevTools (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π `console.log` —á–µ—Ä–µ–∑ `window.console`

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏

–ò—â–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:

```
üîç Telegram WebApp check: {...}
‚úÖ Method 1: Got user from initDataUnsafe: {id: '...', ...}
üì• Loading from Supabase for user: ...
üîç Loading from Supabase with userId: ... (type: string)
üì¶ Supabase response data: [...]
üìä Found X record(s) for user ...
‚úÖ Using user data: {telegram_id: '...', level: ..., tama: ...}
‚úÖ LOADED FROM SUPABASE (PRIMARY): {...}
üìä Current state: TAMA=..., Level=...
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ userId –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π

**–ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**
- –°–∫–æ–ø–∏—Ä—É–π `userId` –∏–∑ –ª–æ–≥–æ–≤

**–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:**
- –°–∫–æ–ø–∏—Ä—É–π `userId` –∏–∑ –ª–æ–≥–æ–≤

**–°—Ä–∞–≤–Ω–∏:**
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ**!

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase

**–ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**
- –ù–∞–π–¥–∏ –≤ –ª–æ–≥–∞—Ö: `‚úÖ Using user data: {telegram_id: '...', level: ..., tama: ...}`
- –ó–∞–ø–∏—à–∏: `level` –∏ `tama`

**–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:**
- –ù–∞–π–¥–∏ –≤ –ª–æ–≥–∞—Ö: `‚úÖ Using user data: {telegram_id: '...', level: ..., tama: ...}`
- –ó–∞–ø–∏—à–∏: `level` –∏ `tama`

**–°—Ä–∞–≤–Ω–∏:**
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ**!

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**
- –°–¥–µ–ª–∞–π –∫–∞–∫–æ–µ-—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ (–∫–ª–∏–∫, –∫–æ—Ä–º–ª–µ–Ω–∏–µ)
- –ò—â–∏ –≤ –ª–æ–≥–∞—Ö:
  ```
  üíæ Saving to Supabase with userId: ... (type: string)
  üì§ Sending to API: {user_id: '...', level: ..., tama: ...}
  ‚úÖ Saved via API: {user_id: '...', level: ..., tama: ...}
  ```

**–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:**
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ –∏–≥—Ä—É
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –†–∞–∑–Ω—ã–µ userId

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ —Ä–∞–∑–Ω—ã–µ `userId` –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

**–ü—Ä–∏—á–∏–Ω–∞:**
- –†–∞–∑–Ω—ã–µ Telegram –∞–∫–∫–∞—É–Ω—Ç—ã
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º `userId` –∏–∑ Telegram WebApp

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ Telegram –∞–∫–∫–∞—É–Ω—Ç
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `window.Telegram.WebApp.initDataUnsafe.user.id` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `üìä Found 2 record(s) for user ...`
- –†–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã—Ö –∑–∞–ø–∏—Å—è—Ö

**–ü—Ä–∏—á–∏–Ω–∞:**
- –°–æ–∑–¥–∞–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –†–∞–∑–Ω—ã–µ `telegram_id` (—Å—Ç—Ä–æ–∫–∞ vs —á–∏—Å–ª–æ)

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Supabase
- –£–¥–∞–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ `telegram_id` –≤—Å–µ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 3: localStorage –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç Supabase

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `üíæ Loading from localStorage (fallback)`
- –ù–æ –ø–æ—Ç–æ–º: `‚úÖ LOADED FROM SUPABASE (PRIMARY)`

**–ü—Ä–∏—á–∏–Ω–∞:**
- localStorage —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
- localStorage –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ, —á–µ–º Supabase

**–†–µ—à–µ–Ω–∏–µ:**
- –û—á–∏—Å—Ç–∏ localStorage: `localStorage.clear()` –≤ –∫–æ–Ω—Å–æ–ª–∏
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Rank –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- Rank –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `#---`
- –í –ª–æ–≥–∞—Ö: `‚ö†Ô∏è User not found in top 50, fetching rank separately...`

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ —Ç–æ–ø-50
- `fetchUserRank()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `‚úÖ Rank fetched separately: X`
- –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å –≤ –±–∞–∑–µ

## –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:

1. **–û—á–∏—Å—Ç–∏ localStorage –Ω–∞ –æ–±–æ–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:**
   ```javascript
   localStorage.clear();
   location.reload();
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Supabase:**
   - –û—Ç–∫—Ä–æ–π Supabase Dashboard
   - –¢–∞–±–ª–∏—Ü–∞ `leaderboard`
   - –ù–∞–π–¥–∏ –∑–∞–ø–∏—Å–∏ —Å `telegram_id = '8445221254'`
   - –ü—Ä–æ–≤–µ—Ä—å, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π
   - –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ - —É–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–µ, –æ—Å—Ç–∞–≤—å —Å–∞–º—É—é —Å–≤–µ–∂—É—é

3. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ API:**
   - –û—Ç–∫—Ä–æ–π Render.com Dashboard
   - –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ API —Å–µ—Ä–≤–∏—Å–∞
   - –ò—â–∏: `üíæ Leaderboard upsert request: user_id=...`

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–ü–æ–¥–æ–∂–¥–∏ 1-2 –º–∏–Ω—É—Ç—ã** (GitHub Pages –æ–±–Ω–æ–≤–∏—Ç—Å—è)
2. **–û—á–∏—Å—Ç–∏ –∫—ç—à –Ω–∞ –æ–±–æ–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:**
   - –ö–æ–º–ø—å—é—Ç–µ—Ä: `Ctrl+Shift+R`
   - –¢–µ–ª–µ—Ñ–æ–Ω: –û—á–∏—Å—Ç–∏ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. **–û—Ç–∫—Ä–æ–π –∏–≥—Ä—É –Ω–∞ –æ–±–æ–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö**
4. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏**
5. **–°—Ä–∞–≤–Ω–∏ –¥–∞–Ω–Ω—ã–µ** - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ!

## –û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –ª–æ–≥–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è, –æ—Ç–ø—Ä–∞–≤—å:

1. –õ–æ–≥–∏ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (–ø–µ—Ä–≤—ã–µ 50 —Å—Ç—Ä–æ–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏)
2. –õ–æ–≥–∏ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
3. –°–∫—Ä–∏–Ω—à–æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase (–∑–∞–ø–∏—Å–∏ –¥–ª—è `telegram_id = '8445221254'`)

