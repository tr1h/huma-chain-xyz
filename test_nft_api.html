<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® TAMA NFT API Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        h2 {
            color: #ffd700;
            margin-bottom: 20px;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #ffd700;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success {
            border-left: 5px solid #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .error {
            border-left: 5px solid #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        
        .nft-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .nft-rarity {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .rarity-common { background: #95a5a6; color: white; }
        .rarity-rare { background: #3498db; color: white; }
        .rarity-epic { background: #9b59b6; color: white; }
        .rarity-legendary { background: #f39c12; color: white; }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .costs-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .cost-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .cost-item h3 {
            margin: 0 0 10px 0;
            color: #ffd700;
        }
        
        .cost-item .tama-cost {
            font-size: 1.2em;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .cost-item .sol-cost {
            font-size: 1em;
            color: #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® TAMA NFT API Test</h1>
        
        <div class="grid">
            <!-- NFT Costs -->
            <div class="container">
                <h2>üí∞ NFT Costs</h2>
                <button onclick="getNFTCosts()">Get NFT Costs</button>
                <div id="costs-result" class="result" style="display: none;"></div>
            </div>
            
            <!-- Mint NFT -->
            <div class="container">
                <h2>üé® Mint NFT</h2>
                <div class="form-group">
                    <label for="mint-user-id">User ID:</label>
                    <input type="text" id="mint-user-id" value="test_user_123" placeholder="Enter user ID">
                </div>
                <div class="form-group">
                    <label for="mint-user-type">User Type:</label>
                    <select id="mint-user-type">
                        <option value="wallet">Wallet Address</option>
                        <option value="telegram">Telegram ID</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pet-name">Pet Name (optional):</label>
                    <input type="text" id="pet-name" placeholder="Enter custom pet name">
                </div>
                <div class="form-group">
                    <label for="rarity">Rarity:</label>
                    <select id="rarity">
                        <option value="common">Common (1,000 TAMA)</option>
                        <option value="rare">Rare (5,000 TAMA)</option>
                        <option value="epic">Epic (10,000 TAMA)</option>
                        <option value="legendary">Legendary (50,000 TAMA)</option>
                    </select>
                </div>
                <button onclick="mintNFT()">üé® Mint NFT</button>
                <div id="mint-result" class="result" style="display: none;"></div>
            </div>
        </div>
        
        <!-- Get NFTs -->
        <div class="container">
            <h2>üìã Get User NFTs</h2>
            <div class="form-group">
                <label for="nfts-user-id">User ID:</label>
                <input type="text" id="nfts-user-id" value="test_user_123" placeholder="Enter user ID">
            </div>
            <div class="form-group">
                <label for="nfts-user-type">User Type:</label>
                <select id="nfts-user-type">
                    <option value="wallet">Wallet Address</option>
                    <option value="telegram">Telegram ID</option>
                </select>
            </div>
            <button onclick="getUserNFTs()">üìã Get NFTs</button>
            <div id="nfts-result" class="result" style="display: none;"></div>
        </div>
        
        <!-- Quick Test -->
        <div class="container">
            <h2>üöÄ Quick Test Sequence</h2>
            <button onclick="runQuickTest()">Run Quick Test</button>
            <div id="quick-test-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8002/api/tama';
        
        async function makeRequest(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                
                return {
                    success: response.ok,
                    data: result,
                    status: response.status
                };
            } catch (error) {
                return {
                    success: false,
                    data: { error: error.message },
                    status: 0
                };
            }
        }
        
        function displayResult(elementId, result, isSuccess = null) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            if (isSuccess !== null) {
                element.className = `result ${isSuccess ? 'success' : 'error'}`;
            } else {
                element.className = 'result';
            }
            
            element.textContent = JSON.stringify(result, null, 2);
        }
        
        async function getNFTCosts() {
            console.log('üí∞ Getting NFT costs...');
            const result = await makeRequest('/nft-costs');
            displayResult('costs-result', result, result.success);
            
            if (result.success && result.data.costs) {
                displayCosts(result.data.costs);
            }
        }
        
        function displayCosts(costs) {
            const costsContainer = document.getElementById('costs-result');
            let html = '<div class="costs-display">';
            
            for (const [rarity, cost] of Object.entries(costs)) {
                html += `
                    <div class="cost-item">
                        <h3>${rarity.charAt(0).toUpperCase() + rarity.slice(1)}</h3>
                        <div class="tama-cost">${cost.tama.toLocaleString()} TAMA</div>
                        <div class="sol-cost">${cost.sol} SOL</div>
                    </div>
                `;
            }
            
            html += '</div>';
            costsContainer.innerHTML = html;
        }
        
        async function mintNFT() {
            const userId = document.getElementById('mint-user-id').value;
            const userType = document.getElementById('mint-user-type').value;
            const petName = document.getElementById('pet-name').value;
            const rarity = document.getElementById('rarity').value;
            
            if (!userId) {
                alert('Please enter User ID');
                return;
            }
            
            console.log('üé® Minting NFT...', { userId, userType, petName, rarity });
            
            const result = await makeRequest('/mint-nft', 'POST', {
                user_id: userId,
                user_type: userType,
                pet_name: petName,
                rarity: rarity
            });
            
            displayResult('mint-result', result, result.success);
        }
        
        async function getUserNFTs() {
            const userId = document.getElementById('nfts-user-id').value;
            const userType = document.getElementById('nfts-user-type').value;
            
            if (!userId) {
                alert('Please enter User ID');
                return;
            }
            
            console.log('üìã Getting user NFTs...', { userId, userType });
            
            const result = await makeRequest(`/nfts?user_id=${userId}&user_type=${userType}`);
            displayResult('nfts-result', result, result.success);
            
            if (result.success && result.data.nfts) {
                displayNFTs(result.data.nfts);
            }
        }
        
        function displayNFTs(nfts) {
            const nftsContainer = document.getElementById('nfts-result');
            let html = '<div class="nft-collection">';
            
            if (nfts.length === 0) {
                html += '<p>No NFTs found for this user.</p>';
            } else {
                nfts.forEach(nft => {
                    html += `
                        <div class="nft-card">
                            <h3>${nft.pet_type.charAt(0).toUpperCase() + nft.pet_type.slice(1)} NFT</h3>
                            <div class="nft-rarity rarity-${nft.rarity}">${nft.rarity.toUpperCase()}</div>
                            <p><strong>Mint Address:</strong> ${nft.mint_address}</p>
                            <p><strong>Cost:</strong> ${nft.cost_tama.toLocaleString()} TAMA + ${nft.cost_sol} SOL</p>
                            <p><strong>Created:</strong> ${new Date(nft.created_at).toLocaleString()}</p>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            nftsContainer.innerHTML = html;
        }
        
        async function runQuickTest() {
            console.log('üöÄ Running quick test sequence...');
            let results = [];
            
            // 1. Test connection
            results.push('1. Testing connection...');
            const testResult = await makeRequest('/test');
            results.push(`   Connection: ${testResult.success ? '‚úÖ Success' : '‚ùå Failed'}`);
            
            // 2. Get NFT costs
            results.push('2. Getting NFT costs...');
            const costsResult = await makeRequest('/nft-costs');
            results.push(`   Costs: ${costsResult.success ? '‚úÖ Success' : '‚ùå Failed'}`);
            
            // 3. Check balance
            results.push('3. Checking balance...');
            const balanceResult = await makeRequest('/balance?user_id=test_user_123&user_type=wallet');
            results.push(`   Balance: ${balanceResult.success ? '‚úÖ Success' : '‚ùå Failed'}`);
            if (balanceResult.success) {
                results.push(`   Current balance: ${balanceResult.data.database_tama} TAMA`);
            }
            
            // 4. Mint a common NFT
            results.push('4. Minting common NFT...');
            const mintResult = await makeRequest('/mint-nft', 'POST', {
                user_id: 'test_user_123',
                user_type: 'wallet',
                pet_name: 'Test Pet',
                rarity: 'common'
            });
            results.push(`   Mint: ${mintResult.success ? '‚úÖ Success' : '‚ùå Failed'}`);
            if (mintResult.success) {
                results.push(`   NFT: ${mintResult.data.nft.name} (${mintResult.data.nft.rarity})`);
                results.push(`   New balance: ${mintResult.data.new_balance} TAMA`);
            }
            
            // 5. Get user NFTs
            results.push('5. Getting user NFTs...');
            const nftsResult = await makeRequest('/nfts?user_id=test_user_123&user_type=wallet');
            results.push(`   NFTs: ${nftsResult.success ? '‚úÖ Success' : '‚ùå Failed'}`);
            if (nftsResult.success) {
                results.push(`   Total NFTs: ${nftsResult.data.total}`);
            }
            
            results.push('\nüéâ Quick test completed successfully!');
            
            displayResult('quick-test-result', results.join('\n'), true);
        }
        
        // Auto-load costs on page load
        window.onload = function() {
            getNFTCosts();
        };
    </script>
</body>
</html>




