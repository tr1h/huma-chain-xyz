<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="telegram:bot" content="gotchigamebot">
    <!-- Removed meta refresh - Telegram needs time to parse Open Graph tags -->
    <!-- Redirect will be handled by JavaScript after page load -->
    
    <!-- Primary Meta Tags -->
    <title>üéÆ Join Solana Tamagotchi - Get 1,000 TAMA Bonus!</title>
    <meta name="title" content="üéÆ Join Solana Tamagotchi - Get 1,000 TAMA Bonus!">
    <meta name="description" content="Join Solana Tamagotchi through your friend's referral link and get 1,000 TAMA bonus! Play-to-earn game on Solana blockchain.">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://solanatamagotchi.com/s.html">
    <meta property="og:title" content="üéÆ Join Solana Tamagotchi - Get 1,000 TAMA Bonus!">
    <meta property="og:description" content="Join through referral link and get 1,000 TAMA bonus! Play-to-earn game on Solana blockchain.">
    <meta property="og:image" content="https://solanatamagotchi.com/logo.png">
    <meta property="og:image:url" content="https://solanatamagotchi.com/logo.png">
    <meta property="og:image:secure_url" content="https://solanatamagotchi.com/logo.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:alt" content="Solana Tamagotchi - Play-to-Earn Game">
    <meta property="og:site_name" content="Solana Tamagotchi">
    <meta property="og:locale" content="en_US">
    
    <!-- Additional Telegram-specific meta tags -->
    <meta name="twitter:image:width" content="512">
    <meta name="twitter:image:height" content="512">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://solanatamagotchi.com/s.html">
    <meta name="twitter:title" content="üéÆ Join Solana Tamagotchi - Get 1,000 TAMA Bonus!">
    <meta name="twitter:description" content="üêæ Play-to-earn game on Solana! Join through referral link and get 1,000 TAMA bonus instantly!">
    <meta name="twitter:image" content="https://solanatamagotchi.com/logo.png">
    <meta name="twitter:image:src" content="https://solanatamagotchi.com/logo.png">
    <meta name="twitter:image:alt" content="Solana Tamagotchi - Join and earn 1,000 TAMA!">
    <meta name="twitter:site" content="@GotchiGame">
    <meta name="twitter:creator" content="@GotchiGame">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/logo.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            text-align: center;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        .logo {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        p {
            font-size: 1.1rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .telegram-link {
            display: inline-block;
            background: #0088cc;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1rem;
            margin-top: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 136, 204, 0.4);
        }
        
        .telegram-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 136, 204, 0.6);
        }
        
        .telegram-link:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- Hidden image for Telegram bots to parse (must be visible in DOM) -->
    <img src="https://solanatamagotchi.com/logo.png" 
         alt="Solana Tamagotchi - Play-to-Earn Game" 
         style="position: absolute; width: 512px; height: 512px; opacity: 0; pointer-events: none; left: -9999px;"
         id="og-image-preview">
    
    <div class="container">
        <div class="logo">üêæ</div>
        <h1>üéÆ Redirecting to Telegram...</h1>
        <p>You're being redirected to join Solana Tamagotchi!</p>
        <p>Get your <strong>1,000 TAMA bonus</strong> when you join! üéÅ</p>
        <div class="loading"></div>
        <p style="font-size: 0.9rem; opacity: 0.7; margin-top: 20px;">
            If you're not redirected automatically, click the button below:
        </p>
        <a href="#" id="telegram-link" class="telegram-link">ü§ñ Open Telegram Bot</a>
    </div>
    
    <script>
        // Get referral code from URL and update meta tags dynamically
        const urlParams = new URLSearchParams(window.location.search);
        const refCode = urlParams.get('ref');
        
        // Update Open Graph URL with referral code if present
        if (refCode) {
            const ogUrl = document.querySelector('meta[property="og:url"]');
            const twitterUrl = document.querySelector('meta[name="twitter:url"]');
            if (ogUrl) {
                ogUrl.setAttribute('content', `https://solanatamagotchi.com/s.html?ref=${refCode}&v=30`);
            }
            if (twitterUrl) {
                twitterUrl.setAttribute('content', `https://solanatamagotchi.com/s.html?ref=${refCode}&v=30`);
            }
            
            // Also update og:image URL to include referral code (for cache busting)
            const ogImage = document.querySelector('meta[property="og:image"]');
            if (ogImage) {
                ogImage.setAttribute('content', `https://solanatamagotchi.com/logo.png?ref=${refCode}&v=30`);
            }
        }
        
        // Preload image to ensure it's available for Telegram bots
        const img = document.getElementById('og-image-preview');
        if (img) {
            img.onload = () => console.log('‚úÖ OG image loaded successfully');
            img.onerror = () => console.error('‚ùå OG image failed to load');
        }
        
        // Build Telegram bot URL - use correct bot username
        const botUsername = 'gotchigamebot';
        let telegramUrl = 'https://t.me/gotchigamebot?start=';
        
        if (refCode) {
            // Validate referral code format (TAMA + 6 alphanumeric)
            const refPattern = /^TAMA[A-Z0-9]{6}$/;
            if (refPattern.test(refCode)) {
                telegramUrl += 'ref' + refCode;
            } else {
                console.warn('Invalid referral code format:', refCode);
                telegramUrl += 'start';
            }
        } else {
            telegramUrl += 'start';
        }
        
        // Try to detect correct bot username from page
        // If we're on solanatamagotchi.com, try to get bot username from meta or config
        try {
            const botMeta = document.querySelector('meta[name="telegram:bot"]');
            if (botMeta && botMeta.content) {
                telegramUrl = `https://t.me/${botMeta.content}?start=${refCode ? 'ref' + refCode : 'start'}`;
            }
        } catch (e) {
            // Use default
        }
        
        // Update link
        const telegramLink = document.getElementById('telegram-link');
        telegramLink.href = telegramUrl;
        
        // Delay redirect to allow Telegram to parse Open Graph tags
        // Telegram needs at least 1-2 seconds to read meta tags before redirect
        setTimeout(() => {
            try {
                window.location.href = telegramUrl;
            } catch (e) {
                console.error('Redirect failed:', e);
                // Show manual link
                const link = document.getElementById('telegram-link');
                if (link) {
                    link.style.display = 'inline-block';
                }
            }
        }, 2000); // 2 seconds delay for Telegram to parse Open Graph tags
        
        // Also redirect on click (backup)
        telegramLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.href = telegramUrl;
        });
        
        // Countdown timer
        let countdown = 2;
        const countdownEl = document.getElementById('countdown');
        const countdownInterval = setInterval(() => {
            countdown--;
            if (countdownEl) {
                countdownEl.textContent = countdown;
            }
            if (countdown <= 0) {
                clearInterval(countdownInterval);
                if (countdownEl && countdownEl.parentElement) {
                    countdownEl.parentElement.style.display = 'none';
                }
            }
        }, 1000);
        
        // Log for debugging
        console.log('üîó Referral redirect:', {
            refCode: refCode || 'none',
            telegramUrl: telegramUrl,
            userAgent: navigator.userAgent
        });
        
        // Show link if redirect fails after 3 seconds
        setTimeout(() => {
            const link = document.getElementById('telegram-link');
            const errorMsg = document.getElementById('error-message');
            if (link) {
                link.style.display = 'inline-block';
            }
            if (errorMsg && document.hasFocus() && window.location.href.includes('s.html')) {
                errorMsg.style.display = 'block';
            }
        }, 3000);
        
        // Also handle page visibility - if user comes back, show link
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                const link = document.getElementById('telegram-link');
                if (link && window.location.href.includes('s.html')) {
                    link.style.display = 'inline-block';
                }
            }
        });
    </script>
</body>
</html>

