<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mint NFT Pet - Solana Tamagotchi</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/mint.css">
    
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Tier Cards */
        .tier-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .tier-card {
            background: linear-gradient(135deg, rgba(138, 201, 38, 0.1), rgba(29, 53, 87, 0.1));
            border: 3px solid rgba(138, 201, 38, 0.3);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tier-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .tier-card.selected {
            border-color: #8AC926;
            background: linear-gradient(135deg, rgba(138, 201, 38, 0.2), rgba(29, 53, 87, 0.2));
            box-shadow: 0 0 30px rgba(138, 201, 38, 0.5);
        }
        
        .tier-card.bronze { border-color: #CD7F32; }
        .tier-card.bronze.selected { border-color: #FFB703; box-shadow: 0 0 30px rgba(205, 127, 50, 0.5); }
        
        .tier-card.silver { border-color: #C0C0C0; }
        .tier-card.silver.selected { border-color: #E5E5E5; box-shadow: 0 0 30px rgba(192, 192, 192, 0.5); }
        
        .tier-card.gold { border-color: #FFD700; }
        .tier-card.gold.selected { border-color: #FFED4E; box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }
        
        .tier-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .tier-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .tier-price {
            font-size: 20px;
            font-weight: bold;
            margin: 15px 0;
            color: #8AC926;
        }
        
        .tier-boost {
            background: linear-gradient(135deg, #FFB703, #FB8500);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: inline-block;
            margin: 10px 0;
        }
        
        .tier-rarities {
            margin-top: 15px;
            font-size: 12px;
            text-align: left;
        }
        
        .tier-rarities div {
            padding: 3px 0;
            opacity: 0.8;
        }
        
        .mint-btn-large {
            width: 100%;
            padding: 20px;
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(135deg, #8AC926 0%, #1D3557 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 5px 20px rgba(138, 201, 38, 0.4);
            margin: 20px 0;
        }
        
        .mint-btn-large:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(138, 201, 38, 0.6);
        }
        
        .mint-btn-large:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .payment-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        
        .payment-btn {
            padding: 10px 20px;
            border: 2px solid rgba(138, 201, 38, 0.3);
            background: rgba(138, 201, 38, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .payment-btn.active {
            border-color: #8AC926;
            background: rgba(138, 201, 38, 0.3);
            box-shadow: 0 0 20px rgba(138, 201, 38, 0.3);
        }
        
        @media (max-width: 768px) {
            .tier-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header style="text-align: center; padding: 30px 0;">
            <div style="font-size: 60px; margin-bottom: 15px;">üêæ</div>
            <h1 style="font-size: 2.5em; margin-bottom: 10px;">MINT YOUR NFT PET</h1>
            <p style="font-size: 1.1em; opacity: 0.8;">Choose your tier ‚Üí Get random rarity ‚Üí Start earning!</p>
        </header>

        <!-- Wallet Connection -->
        <div style="text-align: center; margin: 20px 0;">
            <div id="wallet-section">
                <button id="connect-wallet" class="btn-connect" style="padding: 15px 30px; font-size: 18px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; cursor: pointer;">
                    üëõ Connect Wallet
                </button>
                <div id="wallet-info" style="display: none; margin-top: 15px;">
                    <p style="font-size: 14px; opacity: 0.8;">Connected: <span id="wallet-address" style="font-weight: bold;"></span></p>
                    <p style="font-size: 14px; opacity: 0.8;">Balance: <span id="wallet-balance" style="font-weight: bold;">0 SOL</span></p>
                    <button id="disconnect-wallet" style="padding: 8px 15px; background: #e63946; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">Disconnect</button>
                </div>
            </div>
        </div>

        <!-- Tier Selection -->
        <section style="max-width: 1200px; margin: 0 auto; padding: 30px 20px;">
            <h2 style="text-align: center; font-size: 2em; margin-bottom: 30px;">üíé CHOOSE YOUR TIER</h2>
            
            <div class="tier-selection">
                <!-- BRONZE TIER -->
                <div class="tier-card bronze" onclick="selectTier('Bronze', 2500, 0.05)">
                    <div class="tier-icon">ü•â</div>
                    <div class="tier-name">BRONZE</div>
                    <div class="tier-price" id="bronze-price">2,500 TAMA<br>0.05 SOL</div>
                    <div class="tier-boost">2-3x EARNING</div>
                    <div class="tier-rarities">
                        <div>‚ö™ Common (50%) - 2.0x</div>
                        <div>üü¢ Uncommon (30%) - 2.2x</div>
                        <div>üîµ Rare (15%) - 2.5x</div>
                        <div>üü£ Epic (4%) - 2.8x</div>
                        <div>üü† Legendary (1%) - 3.0x</div>
                    </div>
                </div>

                <!-- SILVER TIER -->
                <div class="tier-card silver" onclick="selectTier('Silver', 5000, 0.1)">
                    <div class="tier-icon">ü•à</div>
                    <div class="tier-name">SILVER</div>
                    <div class="tier-price" id="silver-price">5,000 TAMA<br>0.1 SOL</div>
                    <div class="tier-boost">2.5-3.5x EARNING</div>
                    <div class="tier-rarities">
                        <div>‚ö™ Common (40%) - 2.5x</div>
                        <div>üü¢ Uncommon (30%) - 2.7x</div>
                        <div>üîµ Rare (20%) - 3.0x</div>
                        <div>üü£ Epic (8%) - 3.3x</div>
                        <div>üü† Legendary (2%) - 3.5x</div>
                    </div>
                </div>

                <!-- GOLD TIER -->
                <div class="tier-card gold" onclick="selectTier('Gold', 10000, 0.2)">
                    <div class="tier-icon">ü•á</div>
                    <div class="tier-name">GOLD</div>
                    <div class="tier-price" id="gold-price">10,000 TAMA<br>0.2 SOL</div>
                    <div class="tier-boost">3-4x EARNING</div>
                    <div class="tier-rarities">
                        <div>‚ö™ Common (30%) - 3.0x</div>
                        <div>üü¢ Uncommon (30%) - 3.2x</div>
                        <div>üîµ Rare (25%) - 3.5x</div>
                        <div>üü£ Epic (12%) - 3.8x</div>
                        <div>üü† Legendary (3%) - 4.0x</div>
                    </div>
                </div>
            </div>

            <!-- Payment Method -->
            <div style="text-align: center; margin-top: 30px;">
                <h3 style="margin-bottom: 15px;">üí∞ PAYMENT METHOD</h3>
                <div class="payment-toggle">
                    <button class="payment-btn" id="pay-tama-btn" onclick="selectPayment('tama')">
                        üí∞ Pay with TAMA
                    </button>
                    <button class="payment-btn" id="pay-sol-btn" onclick="selectPayment('sol')">
                        üíé Pay with SOL
                    </button>
                </div>
                <p style="font-size: 14px; opacity: 0.8; margin-top: 10px;">
                    Your TAMA Balance: <span id="user-tama-balance" style="font-weight: bold; color: #FFB703;">Loading...</span>
                </p>
            </div>

            <!-- Mint Button -->
            <button class="mint-btn-large" id="mint-btn" disabled>
                üîí SELECT TIER AND PAYMENT METHOD
            </button>

            <!-- Info Section -->
            <div style="background: rgba(138, 201, 38, 0.1); border-radius: 15px; padding: 30px; margin-top: 30px;">
                <h3 style="text-align: center; margin-bottom: 20px;">üéÅ WHAT YOU GET</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üé®</div>
                        <p style="font-weight: bold;">Unique NFT Pet</p>
                        <p style="font-size: 12px; opacity: 0.8;">10 types, tradeable</p>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üöÄ</div>
                        <p style="font-weight: bold;">Earning Boost</p>
                        <p style="font-size: 12px; opacity: 0.8;">2-4x TAMA rewards</p>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üé≤</div>
                        <p style="font-weight: bold;">Random Rarity</p>
                        <p style="font-size: 12px; opacity: 0.8;">Common ‚Üí Legendary</p>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üéÆ</div>
                        <p style="font-weight: bold;">Play-to-Earn</p>
                        <p style="font-size: 12px; opacity: 0.8;">Instant activation</p>
                    </div>
                </div>
            </div>

            <!-- How It Works -->
            <div style="margin-top: 40px; text-align: center;">
                <h3 style="margin-bottom: 20px;">‚ùì HOW IT WORKS</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; text-align: left;">
                    <div style="background: rgba(29, 53, 87, 0.3); padding: 20px; border-radius: 10px;">
                        <h4 style="color: #8AC926; margin-bottom: 10px;">1Ô∏è‚É£ Choose Tier</h4>
                        <p style="font-size: 14px; opacity: 0.9;">Select Bronze, Silver, or Gold based on your budget and desired earning boost.</p>
                    </div>
                    <div style="background: rgba(29, 53, 87, 0.3); padding: 20px; border-radius: 10px;">
                        <h4 style="color: #8AC926; margin-bottom: 10px;">2Ô∏è‚É£ Random Rarity</h4>
                        <p style="font-size: 14px; opacity: 0.9;">At mint, you'll receive a random rarity (Common ‚Üí Legendary) with different boosts.</p>
                    </div>
                    <div style="background: rgba(29, 53, 87, 0.3); padding: 20px; border-radius: 10px;">
                        <h4 style="color: #8AC926; margin-bottom: 10px;">3Ô∏è‚É£ Start Earning</h4>
                        <p style="font-size: 14px; opacity: 0.9;">Your NFT automatically applies 2-4x boost to ALL TAMA earnings in the game!</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Supabase config (CORRECT URL)
        const SUPABASE_URL = 'https://zfrazyupameidxpjihrh.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmcmF6eXVwYW1laWR4cGppaHJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5Mzc1NTAsImV4cCI6MjA3NTUxMzU1MH0.1EkMDqCNJoAjcJDh3Dd3yPfus-JpdcwE--z2dhjh7wU';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // State
        let selectedTier = null;
        let selectedPayment = null;
        let tamaPrice = 0;
        let solPrice = 0;
        let walletConnected = false;
        let walletAddress = null;
        let userTamaBalance = 0;

        // Wallet Connection
        const { Connection, PublicKey } = solanaWeb3;
        const connection = new Connection('https://api.devnet.solana.com', 'confirmed');

        async function connectPhantomWallet() {
            try {
                const { solana } = window;
                if (solana && solana.isPhantom) {
                    const response = await solana.connect();
                    walletAddress = response.publicKey.toString();
                    walletConnected = true;
                    
                    document.getElementById('connect-wallet').style.display = 'none';
                    document.getElementById('wallet-info').style.display = 'block';
                    document.getElementById('wallet-address').textContent = 
                        walletAddress.substring(0, 4) + '...' + walletAddress.substring(walletAddress.length - 4);
                    
                    await updateWalletBalance();
                    updateMintButton();
                } else {
                    alert('Phantom wallet not found! Please install it from phantom.app');
                    window.open('https://phantom.app/', '_blank');
                }
            } catch (err) {
                console.error('Wallet connection error:', err);
                alert('Failed to connect wallet');
            }
        }

        async function updateWalletBalance() {
            try {
                const balance = await connection.getBalance(new PublicKey(walletAddress));
                const solBalance = (balance / 1000000000).toFixed(4);
                document.getElementById('wallet-balance').textContent = solBalance + ' SOL';
            } catch (err) {
                console.error('Balance error:', err);
            }
        }

        function disconnectWallet() {
            walletConnected = false;
            walletAddress = null;
            document.getElementById('connect-wallet').style.display = 'block';
            document.getElementById('wallet-info').style.display = 'none';
            updateMintButton();
        }

        // Tier Selection
        function selectTier(tier, tama, sol) {
            selectedTier = tier;
            tamaPrice = tama;
            solPrice = sol;
            
            // Update UI
            document.querySelectorAll('.tier-card').forEach(card => card.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            updateMintButton();
        }

        // Payment Selection
        function selectPayment(method) {
            selectedPayment = method;
            
            document.querySelectorAll('.payment-btn').forEach(btn => btn.classList.remove('active'));
            if (method === 'tama') {
                document.getElementById('pay-tama-btn').classList.add('active');
            } else {
                document.getElementById('pay-sol-btn').classList.add('active');
            }
            
            updateMintButton();
        }

        // Update Mint Button
        function updateMintButton() {
            const btn = document.getElementById('mint-btn');
            
            if (!selectedTier) {
                btn.disabled = true;
                btn.textContent = 'üîí SELECT TIER';
                return;
            }
            
            if (!selectedPayment) {
                btn.disabled = true;
                btn.textContent = 'üîí SELECT PAYMENT METHOD';
                return;
            }
            
            if (!walletConnected) {
                btn.disabled = true;
                btn.textContent = 'üîí CONNECT WALLET FIRST';
                return;
            }
            
            btn.disabled = false;
            if (selectedPayment === 'tama') {
                btn.textContent = `üí∞ MINT ${selectedTier} (${tamaPrice.toLocaleString()} TAMA)`;
            } else {
                btn.textContent = `üíé MINT ${selectedTier} (${solPrice} SOL)`;
            }
        }

        // Load User TAMA Balance (REAL-TIME from database)
        async function loadTAMABalance() {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');
            
            if (!userId) {
                document.getElementById('user-tama-balance').textContent = '0 TAMA (Connect via Telegram bot)';
                return;
            }
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                const { data, error } = await supabase
                    .from('leaderboard')
                    .select('tama')
                    .eq('telegram_id', userId)
                    .single();
                
                if (error) throw error;
                
                if (data) {
                    userTamaBalance = data.tama || 0;
                    document.getElementById('user-tama-balance').textContent = userTamaBalance.toLocaleString() + ' TAMA';
                } else {
                    userTamaBalance = 0;
                    document.getElementById('user-tama-balance').textContent = '0 TAMA';
                }
            } catch (err) {
                console.error('Error loading TAMA:', err);
                document.getElementById('user-tama-balance').textContent = 'Error loading balance';
            }
        }
        
        // Auto-refresh balance every 10 seconds
        async function startBalanceRefresh() {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');
            
            if (userId) {
                setInterval(async () => {
                    await loadTAMABalance();
                }, 10000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            }
        }

        // Mint Handler
        document.getElementById('mint-btn').addEventListener('click', async function() {
            if (!selectedTier || !selectedPayment || !walletConnected) {
                alert('Please select tier, payment method, and connect wallet!');
                return;
            }
            
            const mintBtn = document.getElementById('mint-btn');
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');
            
            if (!userId) {
                alert('User ID not found! Please open this page from Telegram bot.');
                return;
            }
            
            // Check balance
            if (selectedPayment === 'tama') {
                if (userTamaBalance < tamaPrice) {
                    alert(`Insufficient TAMA! You need ${tamaPrice.toLocaleString()} TAMA but only have ${userTamaBalance.toLocaleString()}`);
                    return;
                }
                
                // Confirm TAMA payment
                if (!confirm(`Mint ${selectedTier} NFT for ${tamaPrice.toLocaleString()} TAMA?\n\nYou will receive a random rarity with ${selectedTier === 'Bronze' ? '2-3x' : selectedTier === 'Silver' ? '2.5-3.5x' : '3-4x'} earning boost!`)) {
                    return;
                }
                
                // Disable button
                mintBtn.disabled = true;
                mintBtn.textContent = '‚è≥ Minting...';
                
                try {
                    // 1. Deduct TAMA from user balance
                    const { data: currentUser, error: fetchError } = await supabase
                        .from('leaderboard')
                        .select('tama')
                        .eq('telegram_id', userId)
                        .single();
                    
                    if (fetchError) throw fetchError;
                    
                    const newBalance = (currentUser.tama || 0) - tamaPrice;
                    
                    if (newBalance < 0) {
                        throw new Error('Insufficient balance');
                    }
                    
                    const { error: updateError } = await supabase
                        .from('leaderboard')
                        .update({ tama: newBalance })
                        .eq('telegram_id', userId);
                    
                    if (updateError) throw updateError;
                    
                    // 2. Assign random rarity
                    const rarity = assignRandomRarity(selectedTier);
                    const multiplier = getMultiplierForRarity(selectedTier, rarity);
                    
                    // 3. Register NFT in database
                    const nftMintAddress = 'NFT_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    
                    const { error: nftError } = await supabase
                        .from('user_nfts')
                        .insert({
                            telegram_id: userId,
                            nft_mint_address: nftMintAddress,
                            tier_name: selectedTier,
                            rarity: rarity,
                            earning_multiplier: multiplier,
                            is_active: true
                        });
                    
                    if (nftError) throw nftError;
                    
                    // 4. Distribution & Logging (Bronze: 40% burn + 30% treasury + 30% P2E)
                    const distribution = {
                        burn: Math.floor(tamaPrice * 0.40),      // 1000 TAMA
                        treasury: Math.floor(tamaPrice * 0.30),  // 750 TAMA
                        p2e_pool: Math.floor(tamaPrice * 0.30)   // 750 TAMA
                    };
                    
                    const TREASURY_MAIN = '6rY5inYo8JmDTj91UwMKLr1MyxyAAQGjLpJhSi6dNpFM';
                    const P2E_POOL_ID = 'p2e_pool_system'; // System account for P2E pool tracking
                    
                    try {
                        // Main NFT mint transaction
                        await supabase.from('transactions').insert({
                            user_id: userId,
                            username: userId,
                            type: 'nft_mint',
                            amount: tamaPrice,
                            balance_before: currentUser.tama,
                            balance_after: newBalance,
                            metadata: JSON.stringify({
                                tier: selectedTier,
                                rarity: rarity,
                                multiplier: multiplier,
                                nft_id: nftMintAddress,
                                distribution: distribution
                            })
                        });
                        
                        // BURN transaction (40%)
                        await supabase.from('transactions').insert({
                            user_id: 'BURN_ADDRESS',
                            username: 'üî• Token Burn',
                            type: 'burn_from_nft_mint',
                            amount: distribution.burn,
                            balance_before: 0,
                            balance_after: 0,
                            metadata: JSON.stringify({
                                source: 'bronze_nft_mint',
                                nft_id: nftMintAddress,
                                user: userId
                            })
                        });
                        
                        // TREASURY transaction (30%)
                        await supabase.from('transactions').insert({
                            user_id: TREASURY_MAIN,
                            username: 'üí∞ Treasury Main',
                            type: 'treasury_income_from_nft',
                            amount: distribution.treasury,
                            balance_before: 0,
                            balance_after: distribution.treasury,
                            metadata: JSON.stringify({
                                source: 'bronze_nft_mint',
                                nft_id: nftMintAddress,
                                user: userId
                            })
                        });
                        
                        // P2E POOL REFUND transaction (30%)
                        await supabase.from('transactions').insert({
                            user_id: P2E_POOL_ID,
                            username: 'üéÆ P2E Pool Refund',
                            type: 'p2e_pool_refund_from_nft',
                            amount: distribution.p2e_pool,
                            balance_before: 0,
                            balance_after: distribution.p2e_pool,
                            metadata: JSON.stringify({
                                source: 'bronze_nft_mint',
                                nft_id: nftMintAddress,
                                user: userId,
                                pool_address: 'HPQf1MG8e41MoMayD8iqFmadqZ2NteScx4dQuwc1fCQw'
                            })
                        });
                        
                    } catch (txError) {
                        console.error('Failed to log transactions:', txError);
                        // Don't fail the mint if transaction logging fails
                    }
                    
                    // 5. Update balance display
                    await loadTAMABalance();
                    
                    // 6. Success message
                    alert(`‚úÖ SUCCESS!\n\nYou minted ${selectedTier} ${rarity} NFT!\n\nüí∞ Earning Boost: ${multiplier}x\nüé® NFT ID: ${nftMintAddress}\n\nYour earnings are now multiplied by ${multiplier}x!`);
                    
                    // Reset selection
                    selectedTier = null;
                    selectedPayment = null;
                    document.querySelectorAll('.tier-card').forEach(card => card.classList.remove('selected'));
                    document.querySelectorAll('.payment-btn').forEach(btn => btn.classList.remove('active'));
                    updateMintButton();
                    
                } catch (error) {
                    console.error('Mint error:', error);
                    alert(`‚ùå Minting failed: ${error.message}`);
                    mintBtn.disabled = false;
                    updateMintButton();
                }
                
            } else if (selectedPayment === 'sol') {
                // SOL payment
                alert(`Minting ${selectedTier} NFT with ${solPrice} SOL...\n\nSOL payment will be implemented soon!\nUse TAMA for now.`);
            }
        });
        
        // Helper: Assign random rarity based on tier probabilities
        function assignRandomRarity(tier) {
            const random = Math.random() * 100;
            
            if (tier === 'Bronze') {
                if (random < 50) return 'Common';
                if (random < 80) return 'Uncommon';
                if (random < 95) return 'Rare';
                if (random < 99) return 'Epic';
                return 'Legendary';
            } else if (tier === 'Silver') {
                if (random < 40) return 'Common';
                if (random < 70) return 'Uncommon';
                if (random < 90) return 'Rare';
                if (random < 98) return 'Epic';
                return 'Legendary';
            } else if (tier === 'Gold') {
                if (random < 30) return 'Common';
                if (random < 60) return 'Uncommon';
                if (random < 85) return 'Rare';
                if (random < 97) return 'Epic';
                return 'Legendary';
            }
            return 'Common';
        }
        
        // Helper: Get multiplier for tier + rarity
        function getMultiplierForRarity(tier, rarity) {
            const multipliers = {
                'Bronze': { 'Common': 2.0, 'Uncommon': 2.2, 'Rare': 2.5, 'Epic': 2.8, 'Legendary': 3.0 },
                'Silver': { 'Common': 2.5, 'Uncommon': 2.7, 'Rare': 3.0, 'Epic': 3.3, 'Legendary': 3.5 },
                'Gold': { 'Common': 3.0, 'Uncommon': 3.2, 'Rare': 3.5, 'Epic': 3.8, 'Legendary': 4.0 }
            };
            return multipliers[tier]?.[rarity] || 2.0;
        }

        // Event Listeners
        document.getElementById('connect-wallet').addEventListener('click', connectPhantomWallet);
        document.getElementById('disconnect-wallet').addEventListener('click', disconnectWallet);

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            await loadTAMABalance();
            startBalanceRefresh(); // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            console.log('NFT Mint page loaded with real-time TAMA balance');
        });
    </script>
</body>
</html>

